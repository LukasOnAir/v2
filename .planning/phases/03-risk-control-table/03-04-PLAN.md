---
phase: 03-risk-control-table
plan: 04
type: execute
wave: 1
depends_on: [03-01, 03-02, 03-03]
files_modified:
  - src/components/rct/RCTTable.tsx
  - src/stores/rctStore.ts
  - src/components/rct/ScoreSelector.tsx
  - src/components/rct/ControlPanel.tsx
  - src/components/rct/AddColumnDialog.tsx
  - src/components/rct/ColumnVisibilityMenu.tsx
  - src/components/rct/RCTToolbar.tsx
  - src/components/rct/InfoTooltip.tsx
  - src/components/rct/ScoreDropdown.tsx
  - src/components/rct/EditableCell.tsx
  - src/components/rct/EditFormulaDialog.tsx
  - src/components/rct/ColumnManager.tsx
  - src/types/rct.ts
  - src/utils/formulaEngine.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Table columns align with data (header and body widths match)"
    - "Column visibility checkboxes toggle visibility when clicked"
    - "Risk L1 ID filter shows/hides rows based on selection"
    - "Text/Number custom column inputs maintain focus while typing"
    - "Score inputs use dropdown showing numbers 1-5"
    - "Control columns appear between gross score and net score"
    - "Net score is calculated from net probability x net impact in controls"
    - "Custom columns can be deleted (but not pre-installed columns)"
    - "Control type dropdown with 10 options and info descriptions"
    - "Probability/impact cells can have comments explaining reasoning"
    - "Info boxes (i) explain score meanings and control types"
    - "Columns can be reordered via drag & drop"
    - "Formula columns can be edited after creation"
    - "Formulas can reference other custom columns as variables"
  artifacts:
    - path: "src/components/rct/RCTTable.tsx"
      provides: "Fixed table layout, registered filterFns, stable cell inputs"
      contains: "tableLayout: 'fixed'"
    - path: "src/stores/rctStore.ts"
      provides: "Column visibility with updater function support"
      contains: "typeof visibility === 'function'"
    - path: "src/components/rct/ScoreDropdown.tsx"
      provides: "Dropdown score selector replacing visual boxes"
    - path: "src/components/rct/EditableCell.tsx"
      provides: "Memoized cell input that maintains focus"
    - path: "src/components/rct/InfoTooltip.tsx"
      provides: "Reusable info tooltip component"
  key_links:
    - from: "src/components/rct/RCTTable.tsx"
      to: "useReactTable config"
      via: "filterFns registration"
      pattern: "filterFns:\\s*\\{\\s*multiSelect"
    - from: "src/stores/rctStore.ts"
      to: "TanStack Table"
      via: "setColumnVisibility handling updater"
      pattern: "typeof.*function.*\\?.*\\(.*\\)"
---

<objective>
Fix all 14 UAT gaps from Phase 3 testing: 4 major bugs, 4 major enhancements, and 6 minor enhancements.

Purpose: Address user-reported issues to make the RCT fully functional for the Holland Casino demo
Output: Working RCT with all bugs fixed and requested enhancements implemented
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-risk-control-table/03-UAT.md

# Existing implementation files
@src/components/rct/RCTTable.tsx
@src/stores/rctStore.ts
@src/components/rct/ScoreSelector.tsx
@src/components/rct/ControlPanel.tsx
@src/components/rct/AddColumnDialog.tsx
@src/types/rct.ts
@src/utils/formulaEngine.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix critical table bugs (alignment, visibility, filter, input focus)</name>
  <files>
    src/components/rct/RCTTable.tsx
    src/stores/rctStore.ts
    src/components/rct/EditableCell.tsx
  </files>
  <action>
    Fix the 4 major bugs identified in UAT with diagnosed root causes:

    **1. Table column misalignment (RCTTable.tsx):**
    - Line 365: Add `tableLayout: 'fixed'` to table element style
    - Line 373 (th): Add `minWidth: header.getSize()` alongside `width`
    - Line 413 (td): Add `minWidth: cell.column.getSize()` alongside `width`
    - This ensures virtualized absolute-positioned rows have fixed column widths

    **2. Column visibility checkboxes not working (rctStore.ts):**
    - Lines 113-115: The setColumnVisibility action assigns directly instead of handling TanStack Table's updater function pattern
    - Fix: Check if incoming value is a function, if so call it with current state
    ```typescript
    setColumnVisibility: (visibility) => set((state) => {
      if (typeof visibility === 'function') {
        state.columnVisibility = visibility(state.columnVisibility)
      } else {
        state.columnVisibility = visibility
      }
    }),
    ```

    **3. Risk L1 ID filter not working (RCTTable.tsx):**
    - Add `filterFns` configuration to useReactTable (after line 304):
    ```typescript
    filterFns: {
      multiSelect: multiSelectFilter,
    },
    ```
    - Update column definitions to use string reference: `filterFn: 'multiSelect'` instead of `filterFn: multiSelectFilter`

    **4. Text/Number custom column input exits after 1 character (RCTTable.tsx):**
    - Create new file `src/components/rct/EditableCell.tsx` with memoized cell components
    - The issue: `handleCustomValueChange` has `rows` in dependencies (line 98), causing callback recreation on every update
    - Solution: Extract text/number cell inputs to separate memoized components that receive only the specific value and update function
    - Remove `rows` dependency from handleCustomValueChange - use a ref or pass rowId to find row inside the callback
    - Update customColumnDefs (lines 120-138) to use the new EditableCell components

    **EditableCell.tsx structure:**
    ```typescript
    import { memo, useCallback } from 'react'

    interface EditableCellProps {
      value: string | number | null
      onChange: (value: string | number | null) => void
      type: 'text' | 'number'
    }

    export const EditableCell = memo(function EditableCell({ value, onChange, type }: EditableCellProps) {
      const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
        if (type === 'number') {
          onChange(e.target.value ? Number(e.target.value) : null)
        } else {
          onChange(e.target.value)
        }
      }, [onChange, type])

      return (
        <input
          type={type}
          value={value ?? ''}
          onChange={handleChange}
          className="w-full px-2 py-1 bg-transparent border border-transparent hover:border-surface-border focus:border-accent-500 rounded text-sm text-text-primary focus:outline-none"
        />
      )
    })
    ```

    **In RCTTable.tsx, update handleCustomValueChange:**
    ```typescript
    const handleCustomValueChange = useCallback((
      rowId: string,
      columnId: string,
      value: string | number | Date | null
    ) => {
      // Access rows via store directly to avoid dependency
      const currentRows = useRCTStore.getState().rows
      const row = currentRows.find(r => r.id === rowId)
      if (row) {
        updateRow(rowId, {
          customValues: { ...row.customValues, [columnId]: value }
        })
      }
    }, [updateRow]) // Note: no 'rows' dependency
    ```
  </action>
  <verify>
    1. Run `npm run dev` and navigate to RCT page
    2. Generate rows - verify columns align (header widths match body widths)
    3. Open column visibility menu - verify checkboxes toggle visibility
    4. Open Risk L1 ID filter - verify selecting values filters rows
    5. Add a Text custom column - verify can type full words without focus loss
    6. Add a Number custom column - verify can type full numbers without focus loss
  </verify>
  <done>
    - Table columns align correctly with fixed layout
    - Column visibility toggles work via checkboxes and Show All/Hide All
    - Risk L1 ID filter correctly filters rows
    - Text/Number inputs maintain focus during typing
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace score visual selector with dropdown and reorganize columns</name>
  <files>
    src/components/rct/ScoreDropdown.tsx
    src/components/rct/ScoreSelector.tsx
    src/components/rct/RCTTable.tsx
    src/components/rct/ControlPanel.tsx
    src/components/rct/InfoTooltip.tsx
  </files>
  <action>
    **1. Create ScoreDropdown component (new file):**
    Replace the visual 5-box selector with a dropdown showing numbers 1-5 with labels.

    ```typescript
    // src/components/rct/ScoreDropdown.tsx
    import { Info } from 'lucide-react'

    const PROBABILITY_LABELS = ['Rare', 'Unlikely', 'Possible', 'Likely', 'Almost Certain']
    const IMPACT_LABELS = ['Negligible', 'Minor', 'Moderate', 'Major', 'Catastrophic']

    interface ScoreDropdownProps {
      value: number | null
      onChange: (value: number) => void
      type: 'probability' | 'impact'
      showInfo?: boolean
    }

    export function ScoreDropdown({ value, onChange, type, showInfo = false }: ScoreDropdownProps) {
      const labels = type === 'probability' ? PROBABILITY_LABELS : IMPACT_LABELS

      return (
        <div className="flex items-center gap-1">
          <select
            value={value ?? ''}
            onChange={(e) => onChange(Number(e.target.value))}
            className="w-full px-2 py-1 bg-surface-overlay border border-surface-border rounded text-sm text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-500"
          >
            <option value="">-</option>
            {[1, 2, 3, 4, 5].map(score => (
              <option key={score} value={score}>
                {score} - {labels[score - 1]}
              </option>
            ))}
          </select>
          {showInfo && <InfoTooltip type={type} />}
        </div>
      )
    }
    ```

    **2. Create InfoTooltip component (new file):**
    Reusable info icon with tooltip explaining score meanings.

    ```typescript
    // src/components/rct/InfoTooltip.tsx
    import { Info } from 'lucide-react'
    import * as Tooltip from '@radix-ui/react-tooltip'

    const PROBABILITY_INFO = [
      { score: 1, label: 'Rare', description: 'Less than 5% chance of occurrence' },
      { score: 2, label: 'Unlikely', description: '5-25% chance of occurrence' },
      { score: 3, label: 'Possible', description: '25-50% chance of occurrence' },
      { score: 4, label: 'Likely', description: '50-75% chance of occurrence' },
      { score: 5, label: 'Almost Certain', description: 'Greater than 75% chance' },
    ]

    const IMPACT_INFO = [
      { score: 1, label: 'Negligible', description: 'Minimal impact on operations' },
      { score: 2, label: 'Minor', description: 'Small operational disruption' },
      { score: 3, label: 'Moderate', description: 'Noticeable impact requiring response' },
      { score: 4, label: 'Major', description: 'Significant business disruption' },
      { score: 5, label: 'Catastrophic', description: 'Severe/existential threat' },
    ]

    const CONTROL_TYPE_INFO = [
      { type: 'Preventative', description: 'Stops the risk from occurring' },
      { type: 'Detective', description: 'Identifies when risk has occurred' },
      { type: 'Corrective', description: 'Reduces impact after occurrence' },
      { type: 'Directive', description: 'Guides behavior through policies' },
      { type: 'Deterrent', description: 'Discourages risk-taking behavior' },
      { type: 'Compensating', description: 'Alternative control when primary unavailable' },
      { type: 'Acceptance', description: 'Acknowledges and accepts the risk' },
      { type: 'Tolerance', description: 'Operates within acceptable risk levels' },
      { type: 'Manual', description: 'Human-operated control process' },
      { type: 'Automated', description: 'System-operated control process' },
    ]

    interface InfoTooltipProps {
      type: 'probability' | 'impact' | 'controlType'
    }

    export function InfoTooltip({ type }: InfoTooltipProps) {
      const info = type === 'probability' ? PROBABILITY_INFO
        : type === 'impact' ? IMPACT_INFO
        : CONTROL_TYPE_INFO

      return (
        <Tooltip.Provider delayDuration={200}>
          <Tooltip.Root>
            <Tooltip.Trigger asChild>
              <button className="p-1 text-text-muted hover:text-text-secondary transition-colors">
                <Info size={14} />
              </button>
            </Tooltip.Trigger>
            <Tooltip.Portal>
              <Tooltip.Content
                className="bg-surface-elevated border border-surface-border rounded-lg p-3 shadow-xl z-50 max-w-xs"
                sideOffset={5}
              >
                <div className="space-y-2">
                  {type === 'controlType' ? (
                    (info as typeof CONTROL_TYPE_INFO).map(item => (
                      <div key={item.type} className="text-xs">
                        <span className="font-medium text-text-primary">{item.type}:</span>
                        <span className="text-text-secondary ml-1">{item.description}</span>
                      </div>
                    ))
                  ) : (
                    (info as typeof PROBABILITY_INFO).map(item => (
                      <div key={item.score} className="text-xs">
                        <span className="font-medium text-text-primary">{item.score} - {item.label}:</span>
                        <span className="text-text-secondary ml-1">{item.description}</span>
                      </div>
                    ))
                  )}
                </div>
                <Tooltip.Arrow className="fill-surface-border" />
              </Tooltip.Content>
            </Tooltip.Portal>
          </Tooltip.Root>
        </Tooltip.Provider>
      )
    }
    ```

    **3. Update RCTTable.tsx column order:**
    Reorganize columns so Controls appears between Gross Score and Net Score:
    - Move the Controls column (id: 'controls') to appear after Gross Score, Risk Appetite, Within Appetite
    - Net Score should come after Controls

    New column order in the columns array:
    ```
    1. Risk hierarchy (L1-L5 ID and Name)
    2. Process hierarchy (L1-L5 ID and Name)
    3. Gross Probability
    4. Gross Impact
    5. Gross Score
    6. Risk Appetite
    7. Within Appetite
    8. Controls (button to open panel)
    9. Net Score
    10. Custom columns
    ```

    **4. Update RCTTable.tsx to use ScoreDropdown:**
    Replace ScoreSelector usage with ScoreDropdown in grossProbability and grossImpact columns.

    **5. Update ControlPanel.tsx to use ScoreDropdown:**
    Replace ScoreSelector usage with ScoreDropdown for netProbability and netImpact.
    Add showInfo={true} prop to show info tooltips.
  </action>
  <verify>
    1. Gross Probability and Impact cells show dropdown with numbers 1-5 and labels
    2. Controls column appears between Within Appetite and Net Score
    3. Control panel dropdowns show 1-5 with labels
    4. Info (i) icons appear and show tooltips on hover
  </verify>
  <done>
    - Score inputs use dropdown format showing "1 - Rare" through "5 - Almost Certain"
    - Controls column positioned between gross scores and net score
    - Info tooltips explain probability and impact score meanings
  </done>
</task>

<task type="auto">
  <name>Task 3: Add control type dropdown and cell comments</name>
  <files>
    src/types/rct.ts
    src/stores/rctStore.ts
    src/components/rct/ControlPanel.tsx
    src/components/rct/RCTTable.tsx
  </files>
  <action>
    **1. Update Control type in rct.ts:**
    Add controlType and comment fields to Control interface:
    ```typescript
    export interface Control {
      id: string
      description: string
      controlType: ControlType | null  // NEW
      netProbability: number | null
      netImpact: number | null
      netScore: number | null
      comment?: string  // NEW - optional comment explaining control
    }

    export type ControlType =
      | 'Preventative'
      | 'Detective'
      | 'Corrective'
      | 'Directive'
      | 'Deterrent'
      | 'Compensating'
      | 'Acceptance'
      | 'Tolerance'
      | 'Manual'
      | 'Automated'
    ```

    **2. Update RCTRow in rct.ts:**
    Add comment fields for probability and impact:
    ```typescript
    export interface RCTRow {
      // ... existing fields ...
      grossProbabilityComment?: string  // NEW
      grossImpactComment?: string       // NEW
      // ... rest of fields ...
    }
    ```

    **3. Update ControlPanel.tsx:**
    - Add control type dropdown with 10 options and info tooltip
    - Add comment textarea for each control
    - Include InfoTooltip with type="controlType" next to the dropdown

    Add to each control card:
    ```tsx
    {/* Control Type */}
    <div className="mb-3">
      <label className="text-xs text-text-muted block mb-1.5 flex items-center gap-1">
        Control Type
        <InfoTooltip type="controlType" />
      </label>
      <select
        value={control.controlType ?? ''}
        onChange={(e) => updateControl(row.id, control.id, { controlType: e.target.value as ControlType || null })}
        className="w-full px-2 py-1.5 bg-surface-overlay border border-surface-border rounded text-sm text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-500"
      >
        <option value="">Select type...</option>
        {CONTROL_TYPES.map(type => (
          <option key={type} value={type}>{type}</option>
        ))}
      </select>
    </div>

    {/* Comment */}
    <div className="mt-3">
      <label className="text-xs text-text-muted block mb-1.5">Notes</label>
      <textarea
        value={control.comment ?? ''}
        onChange={(e) => updateControl(row.id, control.id, { comment: e.target.value })}
        placeholder="Add notes about this control..."
        rows={2}
        className="w-full px-2 py-1.5 bg-surface-overlay border border-surface-border rounded text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-1 focus:ring-accent-500 resize-none"
      />
    </div>
    ```

    **4. Add probability/impact comment icons to RCTTable.tsx:**
    Add a small comment icon next to score dropdowns that opens a popover for entering comments.

    Create a CommentPopover component or use Radix Popover:
    ```tsx
    {/* In grossProbability cell */}
    <div className="flex items-center gap-1">
      <ScoreDropdown
        value={row.original.grossProbability}
        onChange={(v) => handleScoreChange(row.original.id, 'grossProbability', v)}
        type="probability"
      />
      <CommentButton
        comment={row.original.grossProbabilityComment}
        onChange={(c) => updateRow(row.original.id, { grossProbabilityComment: c })}
      />
    </div>
    ```

    **5. Update rctStore.ts:**
    Ensure updateRow and updateControl handle the new fields (they should already via Object.assign).
    Update addControl to initialize controlType: null.
  </action>
  <verify>
    1. Control panel shows Control Type dropdown with 10 options
    2. Info (i) icon next to Control Type shows descriptions of each type
    3. Each control has a Notes/Comment textarea
    4. Gross Probability and Impact cells have comment icon
    5. Clicking comment icon opens popover to enter/edit comment
    6. Comments persist after closing and refreshing
  </verify>
  <done>
    - Control type dropdown with all 10 options (Preventative through Automated)
    - Info tooltips explain each control type
    - Comments can be added to probability/impact scores
    - Comments can be added to individual controls
  </done>
</task>

<task type="auto">
  <name>Task 4: Add custom column management (delete, drag reorder, formula editing)</name>
  <files>
    src/components/rct/RCTToolbar.tsx
    src/components/rct/ColumnManager.tsx
    src/components/rct/AddColumnDialog.tsx
    src/components/rct/EditFormulaDialog.tsx
    src/components/rct/RCTTable.tsx
    src/stores/rctStore.ts
    src/types/rct.ts
    src/utils/formulaEngine.ts
  </files>
  <action>
    **1. Create ColumnManager component (new file):**
    A dialog/panel for managing custom columns with delete and drag-reorder.

    ```typescript
    // src/components/rct/ColumnManager.tsx
    import { useState } from 'react'
    import * as Dialog from '@radix-ui/react-dialog'
    import { X, GripVertical, Trash2, Edit2 } from 'lucide-react'
    import { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core'
    import { arrayMove, SortableContext, sortableKeyboardCoordinates, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable'
    import { CSS } from '@dnd-kit/utilities'
    import { useRCTStore } from '@/stores/rctStore'
    import type { CustomColumn } from '@/types/rct'

    // ... implement sortable list of custom columns with delete buttons
    // Pre-installed columns should NOT be deletable (only show custom columns)
    // Formula columns should have an Edit button that opens EditFormulaDialog
    ```

    Key features:
    - Show only custom columns (not pre-installed)
    - Each row: drag handle, column name, type badge, edit button (formula only), delete button
    - Drag to reorder using @dnd-kit/sortable
    - Delete button with confirmation
    - Edit button for formula columns opens EditFormulaDialog

    **2. Create EditFormulaDialog component (new file):**
    Allow editing formula after creation.

    ```typescript
    // src/components/rct/EditFormulaDialog.tsx
    import { useState, useEffect } from 'react'
    import * as Dialog from '@radix-ui/react-dialog'
    import { X } from 'lucide-react'
    import { useRCTStore } from '@/stores/rctStore'
    import { validateFormula } from '@/utils/formulaEngine'
    import type { CustomColumn } from '@/types/rct'

    interface EditFormulaDialogProps {
      column: CustomColumn | null
      isOpen: boolean
      onClose: () => void
    }

    export function EditFormulaDialog({ column, isOpen, onClose }: EditFormulaDialogProps) {
      const { updateCustomColumn } = useRCTStore()
      const [formula, setFormula] = useState('')
      const [error, setError] = useState<string | null>(null)

      useEffect(() => {
        if (column?.formula) {
          setFormula(column.formula)
        }
      }, [column])

      // ... implement formula editing with validation
      // On save, call updateCustomColumn(column.id, { formula: newFormula })
    }
    ```

    **3. Add updateCustomColumn action to rctStore.ts:**
    ```typescript
    updateCustomColumn: (columnId: string, updates: Partial<CustomColumn>) => void
    ```

    Implementation:
    ```typescript
    updateCustomColumn: (columnId, updates) => set((state) => {
      const column = state.customColumns.find(c => c.id === columnId)
      if (column) {
        Object.assign(column, updates)
      }
    }),
    ```

    **4. Update RCTToolbar.tsx:**
    Add a "Manage Columns" button that opens ColumnManager:
    ```tsx
    <button
      onClick={() => setIsManageColumnsOpen(true)}
      className="flex items-center gap-1.5 px-3 py-1.5 text-sm bg-surface-elevated border border-surface-border rounded hover:bg-surface-overlay transition-colors"
    >
      <Settings2 size={14} />
      Manage Columns
    </button>
    ```

    **5. Update formulaEngine.ts to support custom column references:**
    The engine already supports custom columns, but verify:
    - Custom column names can be referenced with underscores (e.g., "My_Column")
    - Formula in column A can reference value from column B
    - Circular reference detection (optional but nice to have - show error)

    Update the validateFormula function to accept customColumns parameter and validate references:
    ```typescript
    export function validateFormula(
      formula: string,
      customColumns?: CustomColumn[]
    ): { valid: boolean; error: string | null }
    ```

    **6. Update AddColumnDialog.tsx:**
    Show available custom columns in the formula help text:
    ```tsx
    <p className="mt-1.5 text-xs text-text-muted">
      Available: Gross_Score, Gross_Probability, Gross_Impact, Risk_Appetite, Within_Appetite, Net_Score, Control_Count
      {customColumns.length > 0 && (
        <>, {customColumns.map(c => c.name.replace(/\s/g, '_')).join(', ')}</>
      )}
    </p>
    ```

    **7. Install @dnd-kit dependencies:**
    ```bash
    npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
    ```
  </action>
  <verify>
    1. Click "Manage Columns" in toolbar - dialog opens showing custom columns
    2. Drag a custom column to reorder - order persists
    3. Delete a custom column - column removed from table and data
    4. Pre-installed columns are NOT shown in manage dialog (can't delete them)
    5. Click Edit on a formula column - can modify formula
    6. Create formula column referencing another custom column - works
    7. Run `npm run build` - no TypeScript errors
  </verify>
  <done>
    - Custom columns can be deleted via Manage Columns dialog
    - Columns can be reordered via drag and drop
    - Formula columns can be edited after creation
    - Formulas can reference other custom columns as variables
    - Pre-installed columns cannot be deleted
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `npm run dev` and test all 14 UAT gaps are resolved
2. Run `npm run build` to verify no TypeScript errors
3. Test data persistence - refresh page, verify all data persists
4. Test with many rows - verify virtualized scrolling still works
5. Cross-reference with 03-UAT.md - all gaps should be addressed
</verification>

<success_criteria>
All 14 UAT gaps are fixed:

**Major Bugs (4):**
- [x] Table columns align correctly
- [x] Column visibility checkboxes work
- [x] Risk L1 ID filter works
- [x] Text/Number inputs don't lose focus

**Major Enhancements (4):**
- [x] Score input uses dropdown (1-5)
- [x] Controls column between gross and net
- [x] Net score from probability x impact
- [x] Delete custom columns (not pre-installed)

**Minor Enhancements (6):**
- [x] Control type dropdown with 10 options + info
- [x] Cell comments for probability/impact
- [x] Info boxes explaining scores and control types
- [x] Column drag & drop reordering
- [x] Edit formula columns after creation
- [x] Formulas reference other custom columns

User can complete full RCT workflow without bugs or missing features.
</success_criteria>

<output>
After completion, create `.planning/phases/03-risk-control-table/03-04-SUMMARY.md`
</output>
