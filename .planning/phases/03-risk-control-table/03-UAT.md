---
status: fixed
phase: 03-risk-control-table
source: [03-01-SUMMARY.md, 03-02-SUMMARY.md, 03-03-SUMMARY.md, 03-04-SUMMARY.md]
started: 2026-01-19T16:45:00Z
updated: 2026-01-19T17:35:00Z
fix_plan: 03-04-PLAN.md
---

## Current Test

[testing complete]

## Tests

### 1. RCT Row Generation
expected: Navigate to RCT page. Table shows rows for each leaf risk x leaf process combination. Each row displays hierarchy columns (L1-L5 IDs and names) for risk and process sides.
result: issue
reported: "a row is generated, but the columns are not in line with the data. Another thing, I'd like the impact and probability scores to be a dropdown instead that shows the numbers 1-5. Also, between gross and net come the controls. the controls are to drive the net score down, which is also again generated by a dropdown of net probability and impact (product)."
severity: major

### 2. Score Entry via Visual Selector
expected: Click on a Probability or Impact cell. A visual selector appears with 5 clickable boxes (1-5). Hovering shows labels (e.g., "Rare" to "Almost Certain" for probability). Click to select a score.
result: issue
reported: "This works, but as stated before I want a dropdown instead of this."
severity: minor

### 3. Gross Score Auto-Calculation
expected: After entering both probability and impact scores, the Gross Score cell auto-calculates (probability x impact). Cell shows heatmap coloring (green for low, red for high scores).
result: pass

### 4. Risk Appetite and Within Indicator
expected: Each row has a Risk Appetite column (default 9). A "Within Appetite" cell shows green if gross score <= appetite, red if exceeded, with the delta value displayed.
result: pass

### 5. Control Panel Side Panel
expected: Click "Controls" button on a row. A slide-out panel opens from the right. You can add controls with description, net probability, net impact. Net score auto-calculates.
result: issue
reported: "Works great, but want to add: (1) Control type dropdown with options: Preventative, Detective, Corrective, Directive, Deterrent, Compensating, Acceptance, Tolerance, Manual, Automated - each with description in info box 'i'. (2) Ability to add comments to probability/impact cells to explain reasoning. (3) Info box 'i' to help users understand score meanings."
severity: minor

### 6. Net Score Display
expected: After adding controls, the row's Net Score column shows the minimum net score from all controls. Cell uses heatmap coloring.
result: pass

### 7. Column Visibility Toggle
expected: Find column visibility menu (eye icon or similar in toolbar). Click to see list of columns with checkboxes. Uncheck a column to hide it, check to show it. "Show All" and "Hide All" buttons work.
result: issue
reported: "the box is there, i can open it. but i cant uncheck or uncheck all. nothing happens when i click them."
severity: major

### 8. Excel-like Column Filtering
expected: Click filter icon on any column header. Dropdown shows all unique values with checkboxes. Select/deselect values to filter rows. Clear button resets filter.
result: issue
reported: "works for most columns. doesnt work for risk l1 id. i think it works for all others."
severity: minor

### 9. Add Custom Column
expected: Click "Add Column" in toolbar. Dialog opens with name input and type dropdown (Text, Number, Dropdown, Date, Formula). Create a column, it appears in the table and you can enter values.
result: issue
reported: "Column adds but: (1) Text input exits after typing 1 letter - have to click again for each letter. (2) Same for numbers - stops after 1 digit. (3) Can't delete custom columns. (4) Want drag & drop to reorder all columns. (5) Dropdown works fine. (6) Want to edit formula columns after creation. (7) Want formulas to use variables from other custom columns."
severity: major

### 10. Formula Column
expected: Add a custom column with type "Formula". Enter a formula like "=Gross_Score * 2" or "=IF(Gross_Score>15, 'High', 'Low')". Values calculate based on row data.
result: pass
note: "User reiterated wanting to edit formula after creation - already logged in test 9"

### 11. Data Persistence
expected: Refresh the page (Ctrl+F5). All RCT data (scores, controls, custom columns, values) persists correctly.
result: pass

### 12. Virtualized Scrolling
expected: If you have many rows, scroll through the table. Scrolling should be smooth without lag. Rows render as you scroll.
result: pass

## Summary

total: 12
passed: 6
issues: 6
pending: 0
skipped: 0

## Gaps

- truth: "Table columns align with data and display hierarchy correctly"
  status: failed
  reason: "User reported: columns are not in line with the data"
  severity: major
  test: 1
  root_cause: "Missing table-layout: fixed on table element. Virtualized rows use absolute positioning but header/body columns calculate widths independently without fixed layout."
  artifacts:
    - path: "src/components/rct/RCTTable.tsx"
      issue: "Line 365 needs table-layout: fixed; lines 373 and 413 need minWidth alongside width"
  missing:
    - "Add tableLayout: 'fixed' to table element"
    - "Add minWidth to th and td elements"
  debug_session: ""

- truth: "Score input uses dropdown showing 1-5 numbers"
  status: failed
  reason: "User reported: want impact and probability scores to be a dropdown instead that shows the numbers 1-5"
  severity: major
  test: 1
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Control columns appear between gross and net scores"
  status: failed
  reason: "User reported: between gross and net come the controls"
  severity: major
  test: 1
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Net score driven by net probability and net impact dropdowns in controls"
  status: failed
  reason: "User reported: controls drive net score down via dropdown of net probability and impact (product)"
  severity: major
  test: 1
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Control type dropdown with 10 options (Preventative, Detective, Corrective, Directive, Deterrent, Compensating, Acceptance, Tolerance, Manual, Automated)"
  status: failed
  reason: "User requested: add control type dropdown with descriptions in info box"
  severity: minor
  test: 5
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Cell comments for probability/impact to explain reasoning"
  status: failed
  reason: "User requested: ability to add comments to cells explaining why a score was chosen"
  severity: minor
  test: 5
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Info boxes (i) explaining score meanings and control types"
  status: failed
  reason: "User requested: info box to help users understand what each score means"
  severity: minor
  test: 5
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Column visibility checkboxes toggle column visibility"
  status: failed
  reason: "User reported: can open menu but clicking checkboxes does nothing, Show All/Hide All don't work"
  severity: major
  test: 7
  root_cause: "Type mismatch: TanStack Table onColumnVisibilityChange passes updater function, but Zustand setColumnVisibility assigns it directly instead of calling it"
  artifacts:
    - path: "src/stores/rctStore.ts"
      issue: "Lines 113-115: setColumnVisibility doesn't handle updater function pattern"
  missing:
    - "Check if incoming value is function, call it with current state if so"
  debug_session: ""

- truth: "Filter works on Risk L1 ID column"
  status: failed
  reason: "User reported: filtering doesn't work for Risk L1 ID column, works for all others"
  severity: minor
  test: 8
  root_cause: "Custom filterFn not registered globally with table. Need to add filterFns config and reference by string name."
  artifacts:
    - path: "src/components/rct/RCTTable.tsx"
      issue: "Table config missing filterFns registration; column defs should use string reference"
  missing:
    - "Add filterFns: { multiSelect: multiSelectFilter } to useReactTable config"
    - "Change filterFn: multiSelectFilter to filterFn: 'multiSelect' in column defs"
  debug_session: ""

- truth: "Text/Number custom column input allows typing full values"
  status: failed
  reason: "User reported: input exits after typing 1 character, have to click again for each letter/digit"
  severity: major
  test: 9
  root_cause: "handleCustomValueChange has rows in dependencies, causing callback recreation on every update. This recreates column definitions and cell renderers, causing input unmount/remount and focus loss."
  artifacts:
    - path: "src/components/rct/RCTTable.tsx"
      issue: "Line 98: rows dependency in handleCustomValueChange; lines 120-127, 131-138: inline cell renderers"
  missing:
    - "Remove rows from handleCustomValueChange dependencies"
    - "Extract cell inputs to stable memoized components"
  debug_session: ""

- truth: "Custom columns can be deleted"
  status: failed
  reason: "User reported: can't delete custom columns (but don't allow deleting pre-installed columns)"
  severity: minor
  test: 9
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Columns can be reordered via drag & drop"
  status: failed
  reason: "User requested: drag and drop to interchange/reorder all columns"
  severity: minor
  test: 9
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Formula columns can be edited after creation"
  status: failed
  reason: "User requested: ability to edit formula column after generation"
  severity: minor
  test: 9
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Formulas can reference other custom columns as variables"
  status: failed
  reason: "User requested: use variables from other columns in formulas"
  severity: minor
  test: 9
  root_cause: ""
  artifacts: []
  missing: []
  debug_session: ""
