---
phase: 04-matrix-and-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [src/components/rct/RCTTable.tsx]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "RCT page reads riskFilter and processFilter from URL search params on mount"
    - "Filters are applied to TanStack Table columnFilters state"
    - "Navigating from Matrix 'Jump to RCT' shows filtered view"
  artifacts:
    - path: "src/components/rct/RCTTable.tsx"
      provides: "URL param reading and filter initialization"
      contains: "useSearchParams"
  key_links:
    - from: "src/components/rct/RCTTable.tsx"
      to: "URL search params"
      via: "useSearchParams hook"
      pattern: "searchParams\\.get"
---

<objective>
Fix RCT URL filter application: Read riskFilter and processFilter from URL search params and apply to TanStack Table on page load.

Purpose: UAT Test 5 failed because clicking "Jump to RCT" from Matrix navigates to RCT but doesn't apply the filter. User reported "doesnt apply proper filtering but does jump".

Output: RCTTable.tsx reads URL params and initializes columnFilters state accordingly.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-matrix-and-polish/04-01-SUMMARY.md
@src/components/rct/RCTTable.tsx
@src/components/matrix/MatrixExpandedView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add URL param filter initialization to RCTTable</name>
  <files>src/components/rct/RCTTable.tsx</files>
  <action>
    Add URL search param reading to initialize column filters:

    1. Import useSearchParams from react-router:
       ```typescript
       import { useSearchParams } from 'react-router';
       ```

    2. At component top, read search params:
       ```typescript
       const [searchParams] = useSearchParams();
       ```

    3. Create initial filter state from URL params:
       ```typescript
       const getInitialFilters = (): ColumnFiltersState => {
         const filters: ColumnFiltersState = [];

         const riskFilter = searchParams.get('riskFilter');
         if (riskFilter) {
           filters.push({ id: 'riskName', value: [riskFilter] });
         }

         const processFilter = searchParams.get('processFilter');
         if (processFilter) {
           filters.push({ id: 'processName', value: [processFilter] });
         }

         return filters;
       };
       ```

    4. Update columnFilters state initialization:
       ```typescript
       const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>(getInitialFilters);
       ```

       Note: Pass getInitialFilters as function reference (lazy initialization) so it runs once on mount.

    5. Verify MatrixExpandedView.tsx builds the URL correctly:
       The "Jump to RCT" link should navigate to `/rct?riskFilter=${riskName}&processFilter=${processName}`
       Check this file to confirm the param names match.
  </action>
  <verify>
    1. Navigate to Matrix page
    2. Click on a cell to open expanded view
    3. Click "Jump to RCT" link
    4. Verify URL shows ?riskFilter=...&processFilter=...
    5. Verify RCT table is filtered to show only rows matching that risk and process
    6. Refresh the page - filters should still be applied (read from URL)
  </verify>
  <done>
    - RCTTable imports useSearchParams
    - Filter state initialized from URL params on mount
    - "Jump to RCT" from Matrix shows correctly filtered table
  </done>
</task>

</tasks>

<verification>
- Click cell in Matrix, then "Jump to RCT"
- RCT page loads with filters pre-applied
- Only matching rows visible
- Manual URL entry like `/rct?riskFilter=Credit%20Risk&processFilter=Payments` works
</verification>

<success_criteria>
UAT Test 5 passes: Navigating from Matrix to RCT applies proper filtering based on URL parameters.
</success_criteria>

<output>
After completion, create `.planning/phases/04-matrix-and-polish/04-04-SUMMARY.md`
</output>
