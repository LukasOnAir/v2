---
phase: 05-control-testing
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can set test frequency for a control"
    - "User can record a test result with evidence"
    - "User can view test history"
    - "Overdue tests are visually indicated"
    - "Permissions enforced correctly by role"
  artifacts: []
  key_links: []
---

<objective>
Verify control testing functionality works end-to-end with correct role-based permissions.

Purpose: Ensure all TEST-01, TEST-02, TEST-03 requirements are satisfied before phase completion.
Output: Human verification of complete testing workflow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-control-testing/05-RESEARCH.md
@.planning/phases/05-control-testing/05-01-SUMMARY.md
@.planning/phases/05-control-testing/05-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Control testing functionality:
- TEST-01: Test scheduling (frequency selection per control)
- TEST-02: Test documentation (evidence, findings, recommendations fields)
- TEST-03: Effectiveness tracking (1-5 rating, pass/fail/partial results)
  </what-built>
  <how-to-verify>
**Setup:**
1. Run `npm run dev` and open http://localhost:5173
2. Ensure you have at least one RCT row with a control (add if needed)

**Test as Risk Manager:**
1. Select "Risk Manager" role in dropdown (top right)
2. Click "Controls" on an RCT row
3. Expand "Testing" section on a control
4. Verify you CAN:
   - [x] Change test frequency (dropdown works)
   - [x] Edit test procedure (textarea editable)
   - [x] Click "New Test" to open form
   - [x] Fill out and submit test form
   - [x] See test appear in history immediately

**Test as Control Owner:**
1. Switch to "Control Owner" role
2. Open same control panel
3. Verify you CAN:
   - [x] View testing section
   - [x] See test history
   - [x] Record a new test
4. Verify you CANNOT:
   - [x] Change test frequency (dropdown disabled)
   - [x] Edit test procedure (textarea disabled)

**Test Overdue Indicator:**
1. Switch back to Risk Manager
2. Set frequency to "Monthly" on a control
3. If nextTestDate shows today's date, record a test with a past date
4. Verify "Overdue" badge appears when nextTestDate is in the past

**Test Persistence:**
1. Refresh the page
2. Verify test history and schedule persisted

**Expected Outcomes:**
- Frequency dropdown shows: Not scheduled, Monthly, Quarterly, Annually, As needed
- Test form has: Date, Result, Effectiveness, Tester, Evidence, Findings, Recommendations
- Test history shows sorted by date (newest first)
- Clicking a test history item expands to show details
- Overdue badge appears in red when test is past due
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Human verification of complete testing workflow.
</verification>

<success_criteria>
- All verification steps pass
- TEST-01 (scheduling), TEST-02 (documentation), TEST-03 (effectiveness) requirements satisfied
- Role-based permissions enforced correctly
- Data persists across refresh
</success_criteria>

<output>
After completion, create `.planning/phases/05-control-testing/05-03-SUMMARY.md`
</output>
