---
phase: 06-risk-sunburst-visualization
plan: 04
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified:
  - src/pages/SunburstPage.tsx
  - src/App.tsx
  - src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Sunburst page accessible via sidebar navigation"
    - "Route /sunburst renders the SunburstPage"
    - "Page displays chart, controls, breadcrumb, and legend"
    - "Navigation includes new Sunburst item with icon"
  artifacts:
    - path: "src/pages/SunburstPage.tsx"
      provides: "Page wrapper assembling all sunburst components"
      exports: ["SunburstPage"]
    - path: "src/App.tsx"
      provides: "Updated routing with sunburst route"
      contains: "sunburst"
    - path: "src/components/layout/Sidebar.tsx"
      provides: "Updated navigation with Sunburst link"
      contains: "sunburst"
  key_links:
    - from: "App.tsx"
      to: "SunburstPage"
      via: "React Router route"
      pattern: "path=\"sunburst\""
    - from: "Sidebar.tsx"
      to: "/sunburst"
      via: "NavLink"
      pattern: "to: '/sunburst'"
---

<objective>
Create the Sunburst page and integrate it into the application routing and navigation.

Purpose: Wire all sunburst components together into a complete page and make it accessible from the sidebar navigation.

Output: SunburstPage.tsx, updated App.tsx routing, updated Sidebar navigation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-risk-sunburst-visualization/06-CONTEXT.md
@.planning/phases/06-risk-sunburst-visualization/06-02-SUMMARY.md
@.planning/phases/06-risk-sunburst-visualization/06-03-SUMMARY.md

Reference existing patterns:
@src/pages/MatrixPage.tsx
@src/App.tsx
@src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SunburstPage component</name>
  <files>src/pages/SunburstPage.tsx</files>
  <action>
Create the page that assembles all sunburst components.

**Implementation:**

```typescript
import { useRef } from 'react'
import {
  SunburstChart,
  SunburstControls,
  SunburstBreadcrumb,
  SunburstLegend
} from '@/components/sunburst'
import { useSunburstStore } from '@/stores/sunburstStore'

export function SunburstPage() {
  const svgRef = useRef<SVGSVGElement>(null)
  const { zoomPath, taxonomyType } = useSunburstStore()

  // Build breadcrumb path from zoomPath (array of node IDs)
  // This will be computed from the data - for now pass zoomPath
  const breadcrumbPath = useBreadcrumbPath(zoomPath)

  const handleBreadcrumbNavigate = (nodeId: string) => {
    // Navigate to that level
    // If 'root', reset zoom
    if (nodeId === 'root') {
      useSunburstStore.getState().resetZoom()
    } else {
      // Find the path up to that node and zoom
      const index = zoomPath.indexOf(nodeId)
      if (index >= 0) {
        const newPath = zoomPath.slice(0, index + 1)
        useSunburstStore.getState().zoomTo(nodeId, newPath)
      }
    }
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <h1 className="text-2xl font-semibold text-text-primary mb-4">
        Risk Sunburst
      </h1>

      {/* Controls toolbar */}
      <SunburstControls svgRef={svgRef} />

      {/* Breadcrumb navigation */}
      <div className="my-3">
        <SunburstBreadcrumb
          path={breadcrumbPath}
          onNavigate={handleBreadcrumbNavigate}
        />
      </div>

      {/* Main content area */}
      <div className="flex-1 flex gap-6 items-start">
        {/* Chart */}
        <div className="flex-1 flex justify-center items-center bg-surface-elevated rounded-lg p-4">
          <SunburstChart ref={svgRef} width={600} height={600} />
        </div>

        {/* Legend sidebar */}
        <div className="w-48">
          <SunburstLegend />
        </div>
      </div>
    </div>
  )
}
```

**Note on useBreadcrumbPath:**
Create a helper hook that takes zoomPath (array of node IDs) and returns the full path with names/hierarchicalIds. This may need to look up nodes from the data hierarchy. Keep it simple for now - can iterate.

**Layout considerations:**
- Chart centered in main area
- Legend on the right side
- Controls at top
- Breadcrumb below controls
- Responsive: on smaller screens, legend could move below chart
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>SunburstPage renders complete visualization with all components</done>
</task>

<task type="auto">
  <name>Task 2: Add sunburst route to App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add the sunburst route to React Router configuration.

**Changes:**

1. Import SunburstPage:
   ```typescript
   import { SunburstPage } from './pages/SunburstPage'
   ```

2. Add route inside the Layout routes:
   ```tsx
   <Route element={<Layout />}>
     <Route index element={<Navigate to="/taxonomy" replace />} />
     <Route path="taxonomy" element={<TaxonomyPage />} />
     <Route path="rct" element={<RCTPage />} />
     <Route path="matrix" element={<MatrixPage />} />
     <Route path="sunburst" element={<SunburstPage />} />  {/* NEW */}
   </Route>
   ```

Route path: `/sunburst`
  </action>
  <verify>Run `npm run dev` and navigate to http://localhost:5173/sunburst - page should render (may show empty chart if no data)</verify>
  <done>Route /sunburst exists and renders SunburstPage</done>
</task>

<task type="auto">
  <name>Task 3: Add Sunburst to sidebar navigation</name>
  <files>src/components/layout/Sidebar.tsx</files>
  <action>
Add Sunburst to the navigation items.

**Changes:**

1. Import a suitable icon from lucide-react. Options:
   - `Sun` - represents sunburst/radial
   - `Disc` - circular shape
   - `Target` - concentric circles
   - `PieChart` - closest to sunburst concept

   Recommend `PieChart` as it's the most recognizable chart icon for this purpose.

   ```typescript
   import { Folders, Table, Grid3x3, PieChart, PanelLeftClose, PanelLeft } from 'lucide-react'
   ```

2. Add to navItems array:
   ```typescript
   const navItems = [
     { to: '/taxonomy', icon: Folders, label: 'Taxonomies' },
     { to: '/rct', icon: Table, label: 'Risk Control Table' },
     { to: '/matrix', icon: Grid3x3, label: 'Matrix' },
     { to: '/sunburst', icon: PieChart, label: 'Sunburst' },  // NEW
   ]
   ```

The existing Sidebar component will automatically render the new item using the map.
  </action>
  <verify>Run `npm run dev` and verify Sunburst appears in sidebar with icon; clicking navigates to /sunburst</verify>
  <done>Sidebar shows Sunburst navigation item that links to /sunburst</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run dev` starts without errors
- Navigate to /sunburst shows the page
- Sidebar shows Sunburst item
- Clicking Sunburst in sidebar navigates correctly
</verification>

<success_criteria>
1. SunburstPage assembles chart, controls, breadcrumb, legend
2. Route /sunburst renders the page
3. Sidebar includes Sunburst navigation with icon
4. Page renders without errors (even with empty data)
5. Navigation between pages works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/06-risk-sunburst-visualization/06-04-SUMMARY.md`
</output>
