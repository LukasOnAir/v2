---
phase: 10-analytics-reporting
plan: 04
type: execute
wave: 3
depends_on: ["10-02", "10-03"]
files_modified:
  - src/components/analytics/AnalyticsDashboard.tsx
  - src/components/analytics/index.ts
  - src/pages/AnalyticsPage.tsx
  - src/App.tsx
  - src/components/layout/Sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to Analytics page from sidebar"
    - "Analytics dashboard displays all sections (trends, sampling, aggregation)"
    - "Page is responsive and follows existing layout patterns"
    - "All Phase 10 success criteria are verifiable"
  artifacts:
    - path: "src/components/analytics/AnalyticsDashboard.tsx"
      provides: "Main analytics dashboard layout"
      min_lines: 50
    - path: "src/pages/AnalyticsPage.tsx"
      provides: "Route handler for /analytics"
      min_lines: 5
  key_links:
    - from: "src/App.tsx"
      to: "src/pages/AnalyticsPage.tsx"
      via: "Route component"
      pattern: "path.*analytics"
    - from: "src/components/layout/Sidebar.tsx"
      to: "/analytics"
      via: "NavLink"
      pattern: "to.*analytics"
---

<objective>
Assemble analytics dashboard, create page route, and integrate into navigation.

Purpose: Complete Phase 10 by making analytics features accessible to users.
Output: Navigable Analytics page with all components integrated, ready for verification.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-analytics-reporting/10-RESEARCH.md
@.planning/phases/10-analytics-reporting/10-02-SUMMARY.md
@.planning/phases/10-analytics-reporting/10-03-SUMMARY.md

# Existing page patterns
@src/pages/RemediationPage.tsx
@src/pages/AuditPage.tsx
@src/App.tsx
@src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnalyticsDashboard and AnalyticsPage</name>
  <files>src/components/analytics/AnalyticsDashboard.tsx, src/pages/AnalyticsPage.tsx, src/components/analytics/index.ts</files>
  <action>
1. Create `src/components/analytics/AnalyticsDashboard.tsx`:

Layout structure (vertical stack with gaps):
```
+------------------------------------------+
| Page Header: "Analytics & Reporting"     |
| Subtitle: Trend analysis and sampling    |
+------------------------------------------+
| Row 1: Trend Charts (2 columns on lg)    |
| +----------------+ +------------------+  |
| | Control Test   | | Risk Score       |  |
| | Trends         | | History          |  |
| +----------------+ +------------------+  |
+------------------------------------------+
| Row 2: Full Width                        |
| +--------------------------------------+ |
| | Sampling Calculator                  | |
| +--------------------------------------+ |
+------------------------------------------+
| Row 3: Full Width                        |
| +--------------------------------------+ |
| | Aggregation Report                   | |
| +--------------------------------------+ |
+------------------------------------------+
```

Implementation:
- Page container: max-w-7xl mx-auto px-4 py-6
- Header: flex justify-between items-center mb-6
  - Title: text-2xl font-semibold text-text-primary
  - Subtitle: text-text-secondary
- Grid for trend charts: grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6
  - Each wrapped in TrendChartSection
- Sampling section: mb-6
  - Wrapper with bg-surface rounded-lg p-6
  - Title "Sampling Calculator" as h2
  - SamplingCalculator component
- Aggregation section:
  - AggregationReport component (handles its own container)

2. Create `src/pages/AnalyticsPage.tsx`:
```typescript
import { AnalyticsDashboard } from '@/components/analytics'

export function AnalyticsPage() {
  return <AnalyticsDashboard />
}
```

3. Update `src/components/analytics/index.ts` to include AnalyticsDashboard:
```typescript
export { AnalyticsDashboard } from './AnalyticsDashboard'
// ... existing exports
```
  </action>
  <verify>
- `src/components/analytics/AnalyticsDashboard.tsx` exists
- `src/pages/AnalyticsPage.tsx` exists
- AnalyticsDashboard exported from index.ts
  </verify>
  <done>
- AnalyticsDashboard assembles all analytics components
- AnalyticsPage serves as route handler
  </done>
</task>

<task type="auto">
  <name>Task 2: Add route and sidebar navigation</name>
  <files>src/App.tsx, src/components/layout/Sidebar.tsx</files>
  <action>
1. Update `src/App.tsx`:
   - Import AnalyticsPage from '@/pages/AnalyticsPage'
   - Add Route: `<Route path="/analytics" element={<AnalyticsPage />} />`
   - Place after /audit route (following existing pattern)

2. Update `src/components/layout/Sidebar.tsx`:
   - Import BarChart3 icon from lucide-react (or TrendingUp, whichever is available and appropriate)
   - Add navigation item for Analytics:
     - Icon: BarChart3 (or TrendingUp)
     - Label: "Analytics"
     - Path: "/analytics"
   - Place after Audit Trail item in the nav items array
   - Follow existing NavLink pattern with active styling
  </action>
  <verify>
- App.tsx has /analytics route
- Sidebar.tsx has Analytics nav item
- `npm run dev` starts without errors
  </verify>
  <done>
- User can navigate to /analytics from sidebar
- Route renders AnalyticsPage component
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Analytics & Reporting feature with trend charts, sampling calculator, and aggregation report</what-built>
  <how-to-verify>
1. Start the development server: `npm run dev`
2. Navigate to Analytics page via sidebar (BarChart icon)
3. Verify trend charts section:
   - Control Test Trends chart displays (may show "No test data available" if no tests recorded)
   - Risk Score History chart displays (may show empty if no audit data)
   - Date range selector works (if present)
4. Verify sampling calculator:
   - Enter population size (e.g., 500)
   - Adjust confidence level (95% default)
   - See recommended sample size update (should show 59 for 95%/5%/0%)
   - Expand methodology section to see documentation
5. Verify aggregation report:
   - Shows L1 categories with average scores
   - Toggle between "By Risk" and "By Process" groupings
   - Scores show heatmap colors
6. Verify responsive layout:
   - On large screen: trend charts side by side
   - On small screen: charts stack vertically

Success criteria from roadmap:
- [x] User can view trend charts showing control test results over time
- [x] User can see risk score changes over time
- [x] Statistical sampling tool suggests sample sizes
- [x] Testing methodology documentation visible
- [x] Risk aggregation report shows scores by category
  </how-to-verify>
  <resume-signal>Type "approved" if all criteria pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Analytics page accessible from sidebar navigation
- [ ] Trend charts render (with data or empty state)
- [ ] Sampling calculator returns correct sample sizes
- [ ] Aggregation report groups data by L1 category
- [ ] All ANALYTICS requirements addressed
</verification>

<success_criteria>
- All Phase 10 success criteria verifiable:
  1. Trend charts for control test results
  2. Risk score history from audit trail
  3. Sampling calculator with methodology
  4. Aggregation by business unit/category
</success_criteria>

<output>
After completion, create `.planning/phases/10-analytics-reporting/10-04-SUMMARY.md`
</output>
