---
phase: 11-collaboration-comments
plan: 04
type: execute
wave: 3
depends_on: ["11-02", "11-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can add threaded comments to controls in ControlPanel"
    - "Comments show author role and timestamp"
    - "User can reply to comments"
    - "User can search and filter knowledge base articles"
    - "Knowledge base entries persist across sessions"
---

<objective>
Human verification of complete Collaboration & Comments feature.

Purpose: Ensure all collaboration features work as expected before marking Phase 11 complete.

Output: Verified working collaboration feature with comments on controls and knowledge base.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-collaboration-comments/11-01-SUMMARY.md
@.planning/phases/11-collaboration-comments/11-02-SUMMARY.md
@.planning/phases/11-collaboration-comments/11-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Collaboration & Comments feature including:
1. Comment threads on controls (add, reply, edit, delete)
2. Knowledge base for testing procedures and best practices
3. Fuzzy search and category filtering for knowledge base
4. Role-based permissions for editing
  </what-built>
  <how-to-verify>
**Step 1: Start dev server**
```bash
npm run dev
```
Open http://localhost:5173

**Step 2: Test Comments on Controls**
1. Navigate to RCT (Risk Control Table)
2. Click on a row that has controls (or create one)
3. In the ControlPanel, find the "Comments" collapsible section under a control
4. Expand the Comments section
5. Add a new comment: "This is a test comment"
6. Verify comment shows author role (Risk Manager or Control Owner) and timestamp
7. Click "Reply" on the comment
8. Add a reply: "This is a reply"
9. Verify reply appears indented under the original comment
10. Try to edit your comment (should work)
11. Try to delete your comment (should show confirmation)
12. Switch role to Control Owner and try to delete Risk Manager's comment (should not be allowed OR should work if Risk Manager can moderate all)

**Step 3: Test Knowledge Base**
1. Click "Knowledge Base" in the sidebar
2. See empty state or existing articles
3. As Risk Manager, click "New Article"
4. Fill form:
   - Title: "Control Testing Best Practices"
   - Category: "Best Practices"
   - Tags: "testing, controls, audit"
   - Content: "When testing controls, always document evidence..."
5. Submit and verify article appears in list
6. Search for "testing" - article should appear
7. Search for "tetsing" (typo) - article should still appear (fuzzy search)
8. Filter by "Best Practices" category
9. Click on article to view full content
10. Edit the article and save
11. Delete the article

**Step 4: Test Persistence**
1. Refresh the page
2. Verify comments still appear on controls
3. Verify knowledge base articles still appear
4. Check localStorage has 'riskguard-collaboration' key

**Step 5: Test Role Permissions**
1. Switch to Control Owner role
2. Verify Control Owner can:
   - Add comments
   - View knowledge base
3. Verify Control Owner cannot:
   - Create/edit/delete knowledge base articles (or can they? - document actual behavior)

**Expected Behavior:**
- Comments are threaded with visual indentation
- Author role and relative timestamp shown on each comment
- Fuzzy search finds articles even with typos
- Category filter shows only matching articles
- Data persists in localStorage
  </how-to-verify>
  <resume-signal>Type "approved" if all verification steps pass, or describe specific issues encountered.</resume-signal>
</task>

</tasks>

<verification>
Human confirmation that all collaboration features work correctly.
</verification>

<success_criteria>
- All verification steps pass
- Comments work with threading on controls
- Knowledge base works with search and filtering
- Permissions are appropriate
- Data persists across page refresh
</success_criteria>

<output>
After completion, create `.planning/phases/11-collaboration-comments/11-04-SUMMARY.md`
</output>
