---
phase: 12-formula-bug-fix
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "IF function returns correct value for both true and false conditions"
    - "Smart quotes from copy-paste work correctly"
    - "Error messages guide users to fix common mistakes"
  artifacts: []
  key_links: []
---

<objective>
Verify the formula bug fix works correctly in the application.

Purpose: Confirm the fix resolves the reported issue and doesn't introduce regressions.
Output: Human verification that IF function false clause works correctly.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-formula-bug-fix/12-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Formula engine fix for IF function false clause handling with smart quote normalization</what-built>
  <how-to-verify>
1. Start the development server: `npm run dev`
2. Open http://localhost:5173 in your browser
3. Navigate to the Risk Control Table page
4. Ensure you have some RCT rows with varying Gross Scores (some > 10, some <= 10)

**Test 1: IF Function False Clause (THE BUG FIX)**
5. Click "Columns" button in the toolbar
6. Click "Add Column"
7. Set Name: "Risk Level"
8. Set Type: "Formula"
9. Enter formula: `IF(Gross_Score>10, "High", "Low")`
10. Click "Add"
11. Verify in the table:
    - Rows with Gross Score > 10 show "High"
    - Rows with Gross Score <= 10 show "Low" (not blank, not #ERROR!)

**Test 2: Smart Quotes (Copy-Paste Fix)**
12. Edit the formula column (or create a new one)
13. Copy this formula (contains smart curly quotes): IF(Gross_Score>10, "High", "Low")
14. Paste it as the formula
15. Verify it either:
    - Works correctly (smart quotes normalized), OR
    - Shows a clear error about quote format

**Test 3: Unquoted String Error Message**
16. Try to create a formula: `IF(Gross_Score>10, High, Low)` (no quotes around High/Low)
17. Verify you see an error message like: `"High" looks like text. Add quotes: "High" or 'High'`

**Test 4: Existing Formulas Still Work**
18. Create formula: `Gross_Score * 2`
19. Verify it shows double the gross score value
20. Create formula: `IF(Has_Controls, "Yes", "No")`
21. Verify it shows correct values based on control presence
  </how-to-verify>
  <resume-signal>Type "approved" to confirm all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] IF(Gross_Score>10, "High", "Low") returns "Low" for scores <= 10
- [ ] Smart quotes are handled (either normalized or clear error)
- [ ] Unquoted string arguments show helpful error message
- [ ] Basic arithmetic formulas still work
- [ ] Boolean IF formulas still work
</verification>

<success_criteria>
1. Human confirms IF function false clause works correctly
2. Human confirms smart quote handling works
3. Human confirms error messages are clear
4. Human confirms no regression in existing formula features
</success_criteria>

<output>
After completion, create `.planning/phases/12-formula-bug-fix/12-02-SUMMARY.md`
</output>
