---
phase: 13-controls-hub
plan: 04
type: execute
wave: 4
depends_on: ["13-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can view all controls on Controls Hub page"
    - "Controls show how many risks they cover"
    - "User can link a control to multiple risks"
    - "Control changes propagate to all linked rows"
    - "User can search and filter controls"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Controls Hub feature works as expected.

Purpose: Human verification that all Phase 13 functionality is working correctly before marking the phase complete.

Output: Verified working Controls Hub with multi-risk control linking.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-controls-hub/13-01-SUMMARY.md
@.planning/phases/13-controls-hub/13-02-SUMMARY.md
@.planning/phases/13-controls-hub/13-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Controls Hub feature with:
1. controlsStore with first-class control entities and ControlLink junction table
2. Migration of existing embedded controls to new store
3. ControlsPage showing all controls with link counts
4. ControlDetailPanel for viewing/editing controls and managing links
5. Search and filter functionality
6. Sidebar navigation to Controls page
  </what-built>
  <how-to-verify>
**Prerequisites:**
- Start the dev server: `npm run dev`
- Open browser to http://localhost:5173

**Test 1: Navigation**
1. Click "Controls" in the sidebar (Shield icon)
2. Verify Controls Hub page loads with header showing control count
3. Expected: Page shows "Controls Hub" title and "{N} controls total"

**Test 2: View Existing Controls (if any)**
1. If you have existing controls from RCT, verify they appear in the table
2. Verify each control shows: Name, Type, Net Score, Linked Risks count
3. Expected: All previously created controls are visible with correct data

**Test 3: Migration Verification**
1. Open browser DevTools > Application > Local Storage
2. Check for "riskguard-controls" key
3. Verify it contains controls array and controlLinks array
4. Check migrationVersion is 1
5. Expected: Migration ran successfully, data moved to new store

**Test 4: Control Detail Panel**
1. Click on a control name in the table
2. Verify slide-out panel opens from right
3. Verify panel shows: Name, Description, Type, Net Probability, Net Impact, Net Score
4. Verify "Linked Risks" section shows which risk-process combinations use this control
5. Expected: Panel displays all control details and linked risks

**Test 5: Link Control to Multiple Risks**
1. In detail panel, click "Link to Risk" button
2. Verify dialog shows list of unlinked risk-process combinations
3. Select a risk to link
4. Verify the link appears in "Linked Risks" section
5. Repeat to link same control to another risk
6. Expected: Control shows multiple linked risks

**Test 6: Unlink Control**
1. In detail panel, click the unlink (broken link) icon next to a linked risk
2. Verify the risk is removed from linked list
3. Expected: Risk removed, link count decreases

**Test 7: Search Controls**
1. Type part of a control name in search box
2. Verify table filters to show matching controls
3. Clear search
4. Expected: Fuzzy search works, finding controls by name/description

**Test 8: Filter by Type**
1. Select a control type from dropdown (e.g., "Preventative")
2. Verify only controls of that type are shown
3. Select "All Types" to reset
4. Expected: Type filter works correctly

**Test 9: Add New Control**
1. As Risk Manager, click "Add Control" button
2. Verify detail panel opens for new control
3. Fill in name and description
4. Link to a risk
5. Verify control appears in table
6. Expected: New control created and linkable

**Test 10: Control Owner Restrictions**
1. Switch to Control Owner role (role picker)
2. Verify "Add Control" button is hidden
3. Open a control detail panel
4. Verify name/description/type fields are disabled
5. Verify net score fields may be editable (based on permission)
6. Verify link/unlink buttons are hidden
7. Expected: Proper permission restrictions enforced

**If any test fails:** Describe the issue with steps to reproduce.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Human verification that all Controls Hub functionality works correctly.
</verification>

<success_criteria>
- All 10 verification tests pass
- User approves the feature
- No critical bugs identified
</success_criteria>

<output>
After completion, create `.planning/phases/13-controls-hub/13-04-SUMMARY.md`
</output>
