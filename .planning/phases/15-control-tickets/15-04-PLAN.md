---
phase: 15-control-tickets
plan: 04
type: execute
wave: 3
depends_on: ["15-02", "15-03"]
files_modified:
  - src/components/tickets/TicketsSummary.tsx
  - src/components/tickets/TicketsDashboard.tsx
  - src/pages/TicketsPage.tsx
  - src/components/layout/Sidebar.tsx
  - src/App.tsx
  - src/components/tickets/index.ts
autonomous: false

must_haves:
  truths:
    - "TicketsPage accessible via /tickets route"
    - "Sidebar shows Tickets navigation item"
    - "Dashboard displays stats header with counts by status, priority, category, and overdue"
    - "Dashboard shows Kanban board as primary view"
    - "Complete ticket workflow works: create, edit, drag status, filter, link to controls"
  artifacts:
    - path: "src/pages/TicketsPage.tsx"
      provides: "Tickets page with dashboard"
      exports: ["default"]
    - path: "src/components/tickets/TicketsSummary.tsx"
      provides: "Stats header with ticket counts"
      exports: ["TicketsSummary"]
    - path: "src/components/tickets/TicketsDashboard.tsx"
      provides: "Dashboard composing summary, filters, and Kanban board"
      exports: ["TicketsDashboard"]
  key_links:
    - from: "src/App.tsx"
      to: "src/pages/TicketsPage.tsx"
      via: "Route configuration"
      pattern: "path.*tickets"
    - from: "src/components/layout/Sidebar.tsx"
      to: "/tickets"
      via: "navItems array"
      pattern: "to.*tickets"
    - from: "src/pages/TicketsPage.tsx"
      to: "src/components/tickets/TicketsDashboard.tsx"
      via: "component import"
      pattern: "TicketsDashboard"
---

<objective>
Create the Tickets dashboard page with stats summary and Kanban board, integrate into app routing and navigation.

Purpose: Provide a dedicated page for ticket management with full dashboard functionality.
Output: Complete Tickets page with routing and verification.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-control-tickets/15-CONTEXT.md
@.planning/phases/15-control-tickets/15-RESEARCH.md

# Reference patterns
@src/components/remediation/RemediationDashboard.tsx (dashboard composition pattern)
@src/components/remediation/RemediationSummary.tsx (stats summary pattern)
@src/pages/RemediationPage.tsx (page structure)
@src/components/layout/Sidebar.tsx (navigation)
@src/App.tsx (routing)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TicketsSummary and TicketsDashboard</name>
  <files>src/components/tickets/TicketsSummary.tsx, src/components/tickets/TicketsDashboard.tsx</files>
  <action>
Create src/components/tickets/TicketsSummary.tsx:

1. Create useTicketsSummary hook (following RemediationSummary pattern):
   - Get tickets from store (filter out archived)
   - Compute byStatus: Record<TicketStatus, number>
   - Compute byCategory: Record<TicketCategory, number>
   - Compute byPriority: Record<TicketPriority, number> (only for non-done tickets)
   - Compute overdueCount: tickets where deadline < today and status !== 'done'
   - Return { byStatus, byCategory, byPriority, overdueCount, totalActive }

2. TicketsSummary component:
   - Total Active count (large number with label)
   - Overdue count (red highlight if > 0, green success state if 0)
   - By Status grid (4 cards: To Do, In Progress, Review, Done)
   - By Priority grid (4 cards: Critical, High, Medium, Low) - non-done only
   - By Category grid (4 cards: Maintenance, Periodic Review, Update/Change, Other)
   - Use same styling as RemediationSummary (bg-surface-elevated, rounded-lg, borders)

Status styles:
- 'todo': bg-blue-500/20 text-blue-400
- 'in-progress': bg-amber-500/20 text-amber-400
- 'review': bg-purple-500/20 text-purple-400
- 'done': bg-green-500/20 text-green-400

Category styles:
- 'maintenance': bg-cyan-500/20 text-cyan-400
- 'periodic-review': bg-violet-500/20 text-violet-400
- 'update-change': bg-emerald-500/20 text-emerald-400
- 'other': bg-gray-500/20 text-gray-400

Create src/components/tickets/TicketsDashboard.tsx:

1. State:
   - filters: { categories: TicketCategory[], priorities: TicketPriority[], searchQuery: string }
   - showCreateForm: boolean
   - editingTicket: Ticket | null

2. Layout:
   - Page title "Tickets" with "Create Ticket" button
   - TicketsSummary component (collapsible or always visible)
   - TicketFilters component
   - KanbanBoard component with filters prop
   - TicketForm modal (controlled by showCreateForm and editingTicket)

3. Handle edit: KanbanBoard passes onEditTicket callback -> sets editingTicket
4. Handle create: Create button -> sets showCreateForm true
5. Handle close: Clear editingTicket and showCreateForm

Update src/components/tickets/index.ts to export TicketsSummary and TicketsDashboard.
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Components export correctly
  </verify>
  <done>
- TicketsSummary shows counts by status, priority, category, and overdue
- TicketsDashboard composes all ticket components
- Create/edit ticket functionality works from dashboard
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TicketsPage and integrate routing</name>
  <files>src/pages/TicketsPage.tsx, src/components/layout/Sidebar.tsx, src/App.tsx</files>
  <action>
Create src/pages/TicketsPage.tsx:

1. Import TicketsDashboard from '@/components/tickets'
2. Simple page wrapper:
   ```tsx
   export default function TicketsPage() {
     return (
       <div className="p-6 space-y-6">
         <TicketsDashboard />
       </div>
     )
   }
   ```

Update src/components/layout/Sidebar.tsx:

1. Import Ticket icon from lucide-react (or use ClipboardCheck as alternative)
2. Add to navItems array after Remediation:
   ```ts
   { to: '/tickets', icon: Ticket, label: 'Tickets' }
   ```

Update src/App.tsx:

1. Import TicketsPage: `const TicketsPage = lazy(() => import('@/pages/TicketsPage'))`
2. Add route in Routes (after remediation route):
   ```tsx
   <Route path="/tickets" element={<TicketsPage />} />
   ```
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- App runs: `npm run dev`
- Navigate to /tickets works
  </verify>
  <done>
- TicketsPage renders at /tickets
- Sidebar shows Tickets navigation item
- Navigation to Tickets page works
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete ticket system: types, store, Kanban board with drag-and-drop, control integration, and dashboard page</what-built>
  <how-to-verify>
1. Start the app: `npm run dev`
2. Navigate to Tickets page via sidebar
3. Dashboard verification:
   - Stats header shows counts (should be 0 initially)
   - Kanban board shows 4 empty columns
4. Create ticket:
   - Click "Create Ticket" button
   - Fill form: title, category, priority, owner, deadline
   - Link to a control (if controls exist)
   - Save and verify ticket appears in "To Do" column
5. Drag-and-drop:
   - Drag ticket to "In Progress" column
   - Verify status changes (card moves)
   - DragOverlay shows ticket while dragging
6. Edit ticket:
   - Click on ticket card
   - Modify fields
   - Save and verify changes
7. Filters:
   - Filter by category (e.g., show only "Maintenance")
   - Filter by priority (e.g., show only "High")
   - Search by title
8. Overdue indication:
   - Create ticket with past deadline
   - Verify red border on card
9. Control integration:
   - Open ControlPanel for a control
   - Find Tickets section (collapsible)
   - Create ticket from control context
   - Verify ticket linked to that control
10. Controls Hub:
    - Navigate to Controls page
    - Verify ticket indicator shows on controls with tickets
    - Indicator color reflects status (green/amber/red)
11. Recurrence (optional):
    - Create ticket with recurrence (e.g., monthly)
    - Drag to "Done"
    - Verify new ticket created with next deadline
12. Archive (optional):
    - Note that done tickets should auto-archive after configured period
  </how-to-verify>
  <resume-signal>Type "approved" if all features work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- App runs without errors
- Tickets page accessible at /tickets
- Complete workflow functional
</verification>

<success_criteria>
- TicketsPage renders dashboard with stats and Kanban board
- Sidebar includes Tickets navigation item
- Full ticket lifecycle: create, edit, drag status, filter, link controls
- Overdue tickets highlighted
- Control integration working (TicketsSection, ControlTicketIndicator)
- Recurrence creates new tickets on completion
</success_criteria>

<output>
After completion, create `.planning/phases/15-control-tickets/15-04-SUMMARY.md`
</output>
