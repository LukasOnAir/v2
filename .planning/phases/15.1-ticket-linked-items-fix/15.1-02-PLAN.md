# Plan: Add "Other" Option for Custom Linked Items

---
wave: 2
depends_on: ["15.1-01"]
files_modified:
  - src/types/tickets.ts
  - src/stores/ticketsStore.ts
  - src/components/tickets/TicketForm.tsx
autonomous: true
---

## Objective

Add an "Other" option to the linked items dropdown that allows users to enter custom text describing what the ticket relates to when the item isn't in the predefined list (controls, risks, processes, RCT rows).

## Context

Current linked item types:
- Control
- Risk (Taxonomy)
- Process (Taxonomy)
- Risk-Process Row (RCT)

User wants: an "Other" option where they can type a free-text description for items outside these categories.

## Tasks

<task id="1">
<title>Extend TicketLinkEntityType to include 'other'</title>
<file>src/types/tickets.ts</file>
<action>edit</action>
<description>
Add 'other' to the TicketLinkEntityType union:

```typescript
export type TicketLinkEntityType = 'control' | 'risk' | 'process' | 'rctRow' | 'other'
```

For 'other' type:
- `entityId` will be a generated nanoid (for uniqueness)
- `entityName` will contain the user's custom description text
</description>
</task>

<task id="2">
<title>Add "Other" to entity type options in TicketForm</title>
<file>src/components/tickets/TicketForm.tsx</file>
<action>edit</action>
<description>
Update ENTITY_TYPE_OPTIONS to include "Other":

```typescript
const ENTITY_TYPE_OPTIONS: { value: TicketLinkEntityType; label: string }[] = [
  { value: 'control', label: 'Control' },
  { value: 'risk', label: 'Risk (Taxonomy)' },
  { value: 'process', label: 'Process (Taxonomy)' },
  { value: 'rctRow', label: 'Risk-Process Row (RCT)' },
  { value: 'other', label: 'Other' },
]
```
</description>
</task>

<task id="3">
<title>Add custom text input when "Other" is selected</title>
<file>src/components/tickets/TicketForm.tsx</file>
<action>edit</action>
<description>
When `selectedEntityType === 'other'`, show a text input instead of the dropdown:

```tsx
{selectedEntityType === 'other' ? (
  <div className="flex items-center gap-2">
    <input
      type="text"
      id="other-entity-input"
      placeholder="Describe the linked item..."
      className="flex-1 px-3 py-2 bg-surface-base border border-surface-border rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:ring-2 focus:ring-accent-500"
    />
    <button
      type="button"
      onClick={() => {
        const input = document.getElementById('other-entity-input') as HTMLInputElement
        const description = input.value.trim()
        if (description) {
          handleAddEntity('other', nanoid(), description)
          input.value = ''
        }
      }}
      className="p-2 bg-accent-600 hover:bg-accent-700 text-white rounded-lg transition-colors"
    >
      <Plus size={18} />
    </button>
  </div>
) : (
  // Existing dropdown for other entity types
)}
```

Import `nanoid` at the top of the file for generating unique IDs.
</description>
</task>

<task id="4">
<title>Update getEntityTypeLabel for "Other" display</title>
<file>src/components/tickets/TicketForm.tsx</file>
<action>edit</action>
<description>
The linked items list already shows the entity type badge. Ensure "Other" displays correctly:

```typescript
const getEntityTypeLabel = (type: TicketLinkEntityType): string => {
  return ENTITY_TYPE_OPTIONS.find((opt) => opt.value === type)?.label || type
}
```

This already works since we added "Other" to ENTITY_TYPE_OPTIONS.

The badge will show "Other" and the entityName will show the user's custom description.
</description>
</task>

<task id="5">
<title>Handle "Jump to item" gracefully for "Other" type</title>
<file>src/components/tickets/TicketForm.tsx</file>
<action>edit</action>
<description>
The handleJumpToEntity function navigates to the linked entity. For "Other" type, there's nowhere to navigate, so:

1. Hide the jump button for "Other" type links
2. Or show a disabled state with tooltip "Custom items cannot be opened"

Update the linked item rendering:

```tsx
{link.entityType !== 'other' && (
  <button
    type="button"
    onClick={() => handleJumpToEntity(link.entityType, link.entityId)}
    title="Jump to item"
    className="p-1 text-text-muted hover:text-accent-400 transition-colors opacity-0 group-hover:opacity-100"
  >
    <ExternalLink size={16} />
  </button>
)}
```
</description>
</task>

<task id="6">
<title>Ensure "Other" links display correctly throughout the app</title>
<file>src/components/tickets/TicketForm.tsx</file>
<action>verify</action>
<description>
Verify that "Other" type links:
1. Display correctly in the ticket form when editing
2. Show the correct badge color/style (can use same blue as other types)
3. Show the custom description text as the entity name
4. Can be removed like any other link
5. Persist correctly to localStorage
</description>
</task>

## Verification

After completion:
1. Select "Other" in entity type selector → Text input appears
2. Enter custom description, click add → Link appears with "Other" badge and description
3. "Other" links don't show "Jump to item" button
4. Save ticket → Reopen → "Other" links persist correctly
5. Can remove "Other" links same as other types

## must_haves

- [ ] "Other" option available in entity type selector
- [ ] Text input appears when "Other" is selected
- [ ] Custom description is saved as entityName
- [ ] "Other" links display with correct badge and description
- [ ] "Other" links persist correctly (localStorage)
