---
phase: 18-login-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/stores/uiStore.ts
  - src/components/auth/ProtectedRoute.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Unauthenticated user is redirected to /login"
    - "Authenticated user can access all application routes"
    - "Demo credentials (demo/demo) authenticate successfully"
    - "Auth state persists across browser refresh"
  artifacts:
    - path: "src/stores/uiStore.ts"
      provides: "isAuthenticated state, login(), logout() actions"
      contains: "isAuthenticated"
    - path: "src/components/auth/ProtectedRoute.tsx"
      provides: "Route guard component"
      exports: ["ProtectedRoute"]
    - path: "src/App.tsx"
      provides: "Login route and protected route wrapper"
      contains: "ProtectedRoute"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/auth/ProtectedRoute.tsx"
      via: "import and route wrapping"
      pattern: "ProtectedRoute"
    - from: "src/components/auth/ProtectedRoute.tsx"
      to: "src/stores/uiStore.ts"
      via: "useUIStore hook"
      pattern: "useUIStore.*isAuthenticated"
---

<objective>
Set up authentication infrastructure and install Motion animation library

Purpose: Create the foundation for login page - auth state, route protection, and animation dependency
Output: Protected routes redirect to /login, motion library available for animations
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-login-page/18-RESEARCH.md

# Existing files to modify
@src/stores/uiStore.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Motion and extend uiStore with auth state</name>
  <files>package.json, package-lock.json, src/stores/uiStore.ts</files>
  <action>
1. Install motion library:
   ```bash
   npm install motion
   ```

2. Extend src/stores/uiStore.ts with authentication state:
   - Add `isAuthenticated: boolean` to UIState interface (default: false)
   - Add `login: (username: string, password: string) => boolean` action
     - If username === 'demo' AND password === 'demo', set isAuthenticated to true and return true
     - Otherwise return false
   - Add `logout: () => void` action that sets isAuthenticated to false
   - Ensure these fields are persisted to localStorage (already using persist middleware)
  </action>
  <verify>
    - `npm list motion` shows motion@11.x installed
    - uiStore.ts exports login, logout functions and isAuthenticated state
  </verify>
  <done>Motion installed. uiStore has isAuthenticated boolean with login()/logout() actions that persist to localStorage.</done>
</task>

<task type="auto">
  <name>Task 2: Create ProtectedRoute component</name>
  <files>src/components/auth/ProtectedRoute.tsx</files>
  <action>
Create src/components/auth/ProtectedRoute.tsx:

1. Create the auth directory: src/components/auth/

2. Create ProtectedRoute.tsx:
   - Import Navigate, Outlet, useLocation from 'react-router'
   - Import useUIStore from '@/stores/uiStore'
   - Check `isAuthenticated` from store
   - If NOT authenticated: return `<Navigate to="/login" state={{ from: location }} replace />`
   - If authenticated: return `<Outlet />`

Pattern from research:
```typescript
import { Navigate, Outlet, useLocation } from 'react-router'
import { useUIStore } from '@/stores/uiStore'

export function ProtectedRoute() {
  const isAuthenticated = useUIStore((state) => state.isAuthenticated)
  const location = useLocation()

  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />
  }

  return <Outlet />
}
```
  </action>
  <verify>
    - File exists at src/components/auth/ProtectedRoute.tsx
    - TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>ProtectedRoute component created that redirects unauthenticated users to /login and renders Outlet for authenticated users.</done>
</task>

<task type="auto">
  <name>Task 3: Update App.tsx routing structure</name>
  <files>src/App.tsx</files>
  <action>
Update src/App.tsx to add login route and wrap existing routes:

1. Import ProtectedRoute from '@/components/auth/ProtectedRoute'

2. Create a placeholder LoginPage component (temporary, will be replaced in Plan 02):
   ```typescript
   function LoginPage() {
     return <div className="h-screen flex items-center justify-center bg-surface-base text-text-primary">Login Page (coming in Plan 02)</div>
   }
   ```

3. Restructure Routes to:
   - Add `/login` route OUTSIDE protected area: `<Route path="login" element={<LoginPage />} />`
   - Wrap Layout route with ProtectedRoute: `<Route element={<ProtectedRoute />}>` around the Layout route

Final structure:
```typescript
<Routes>
  {/* Login route - outside protected area */}
  <Route path="login" element={<LoginPage />} />

  {/* Protected routes wrapped with ProtectedRoute */}
  <Route element={<ProtectedRoute />}>
    <Route element={<Layout />}>
      <Route index element={<Navigate to="/taxonomy" replace />} />
      {/* ... existing routes remain unchanged ... */}
    </Route>
  </Route>
</Routes>
```
  </action>
  <verify>
    - App compiles: `npm run build` succeeds
    - Visiting http://localhost:5173 redirects to /login
    - Dev console shows no errors
  </verify>
  <done>App.tsx updated with login route outside protected routes. Unauthenticated users are redirected to /login. Authenticated users can access all existing routes.</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - should succeed
2. Run `npm run dev` and visit http://localhost:5173
3. Verify redirect to /login (should show placeholder)
4. In browser console, run: `localStorage.setItem('riskguard-ui', JSON.stringify({state:{isAuthenticated:true,selectedRole:'risk-manager',sidebarCollapsed:false},version:0}))`
5. Refresh page - should now access main app (redirected to /taxonomy)
6. Clear localStorage and verify redirect back to /login
</verification>

<success_criteria>
1. Motion library installed and available
2. uiStore has isAuthenticated, login(), logout() with persistence
3. ProtectedRoute guards all existing routes
4. /login route exists outside protected routes
5. Unauthenticated users are redirected to /login
6. Auth state persists across browser refresh
</success_criteria>

<output>
After completion, create `.planning/phases/18-login-page/18-01-SUMMARY.md`
</output>
