---
phase: 19-mock-data-loader
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/mockDataLoader.ts
autonomous: true

must_haves:
  truths:
    - "loadMockData() function populates all application stores"
    - "Mock taxonomies have 5 levels deep with realistic casino risk content"
    - "Mock data includes varied risk scores (high, medium, low distribution)"
    - "Mock controls are linked to multiple RCT rows"
    - "Mock data includes pending approval changes for demonstration"
    - "Mock data includes audit entries showing recent activity"
  artifacts:
    - path: "src/utils/mockDataLoader.ts"
      provides: "Mock data generation and store population"
      exports: ["loadMockData"]
      min_lines: 300
  key_links:
    - from: "mockDataLoader.ts"
      to: "useTaxonomyStore"
      via: "setRisks, setProcesses"
      pattern: "useTaxonomyStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useRCTStore"
      via: "setRows, setControlTests, setRemediationPlans"
      pattern: "useRCTStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useControlsStore"
      via: "setControls, setControlLinks"
      pattern: "useControlsStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useTicketsStore"
      via: "setTickets, setTicketEntityLinks"
      pattern: "useTicketsStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useCollaborationStore"
      via: "setComments, setKnowledgeBaseEntries"
      pattern: "useCollaborationStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useApprovalStore"
      via: "setPendingChanges, updateSettings"
      pattern: "useApprovalStore\\.getState\\(\\)"
    - from: "mockDataLoader.ts"
      to: "useAuditStore"
      via: "setEntries"
      pattern: "useAuditStore\\.getState\\(\\)"
---

<objective>
Create the mock data generation module that produces comprehensive demo data for all application features.

Purpose: Enable one-click demo data loading that showcases every application capability (sunburst, matrix, approval workflow, tickets, etc.)

Output: `src/utils/mockDataLoader.ts` exporting `loadMockData()` function that populates all Zustand stores
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-mock-data-loader/19-RESEARCH.md

@src/types/taxonomy.ts
@src/types/rct.ts
@src/types/tickets.ts
@src/types/approval.ts
@src/types/collaboration.ts
@src/types/audit.ts
@src/stores/taxonomyStore.ts
@src/stores/rctStore.ts
@src/stores/controlsStore.ts
@src/stores/ticketsStore.ts
@src/stores/collaborationStore.ts
@src/stores/approvalStore.ts
@src/stores/auditStore.ts
@src/utils/rctGenerator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mock data generator module</name>
  <files>src/utils/mockDataLoader.ts</files>
  <action>
Create `src/utils/mockDataLoader.ts` with the following structure:

**Imports:**
- `nanoid` for ID generation
- All store hooks: `useTaxonomyStore`, `useRCTStore`, `useControlsStore`, `useTicketsStore`, `useCollaborationStore`, `useApprovalStore`, `useAuditStore`
- `generateRCTRows` from `@/utils/rctGenerator`
- `format`, `subDays`, `addDays` from `date-fns`
- All relevant types

**Factory Functions:**

1. `createTaxonomyItem(name, description, children?)`: Returns TaxonomyItem with nanoid() id, empty hierarchicalId (regenerated by store setter)

2. `generateMockRisks()`: Returns TaxonomyItem[] with 5-level hierarchy:
   - L1: Operational Risk, Financial Risk, Compliance Risk
   - L2: Under Operational: Process Risk, Technology Risk, Human Risk
   - L3-L5: Casino-specific content (Gaming Operations > Table Games > Blackjack Procedures)
   - Total: ~20-25 leaf items

3. `generateMockProcesses()`: Returns TaxonomyItem[] with 5-level hierarchy:
   - L1: Gaming Floor, Cage Operations, Security, Marketing
   - L2-L5: Detailed process breakdowns
   - Total: ~15-20 leaf items

4. `generateMockScores(rows)`: Populates RCT rows with varied scores:
   - ~30% high risk (P:4-5, I:4-5, gross 15-25)
   - ~40% medium risk (P:2-4, I:2-4, gross 6-14)
   - ~30% low risk (P:1-2, I:1-2, gross 1-5)
   - Some rows with comments on grossProbability/grossImpact
   - Returns modified rows array

5. `generateMockControls(rows)`: Creates 15-20 Control objects:
   - Various controlTypes (Preventative, Detective, Corrective, etc.)
   - Test schedules (monthly, quarterly, annually)
   - Some with nextTestDate in past (overdue)
   - Some with lastTestDate set
   - Returns { controls: Control[], links: ControlLink[] }
   - IMPORTANT: Link some controls to multiple rows

6. `generateMockControlTests(controls, rows)`: Creates 20-30 ControlTest records:
   - Mix of pass/fail/partial results
   - Dates spanning last 6 months
   - Include effectiveness ratings

7. `generateMockRemediationPlans(tests, controls, rows)`: Creates 5-10 RemediationPlan:
   - Various statuses: open, in-progress, resolved
   - Some with deadlines in past (overdue)
   - Include action items (some completed, some pending)

8. `generateMockTickets(controls)`: Creates 10-15 Ticket objects:
   - Various statuses across Kanban columns
   - Various categories and priorities
   - 1-2 with recurrence config
   - Returns { tickets: Ticket[], links: TicketEntityLink[] }

9. `generateMockComments(controls, rows)`: Creates 10-20 Comment objects:
   - Various entityTypes (control, rctRow)
   - Some with replies (threaded using parentId)
   - Mix of risk-manager and control-owner authors

10. `generateMockKnowledgeBase()`: Creates 5-8 KnowledgeBaseEntry:
    - Various categories: testing-procedure, best-practice, policy, template
    - Realistic titles and content
    - Include tags for filtering

11. `generateMockPendingChanges(controls, risks)`: Creates 3-5 PendingChange:
    - Mix of entityTypes (control, risk, process)
    - Status 'pending' for approval queue demonstration
    - Include proposedValues and currentValues

12. `generateMockAuditEntries(controls, risks)`: Creates 10-20 AuditEntry objects:
    - Various entityTypes (control, risk, rctRow, ticket)
    - Mix of changeTypes (create, update, delete)
    - Timestamps spanning last 30 days
    - Realistic fieldChanges arrays showing before/after values
    - Include user names (e.g., "risk-manager", "control-owner")
    - Include summaries (e.g., "Created control 'Daily Cash Count'", "Updated risk score")

**Main Function:**

`loadMockData()`:
1. Generate risks and processes
2. Set taxonomies: `useTaxonomyStore.getState().setRisks(risks)` and `setProcesses(processes)`
3. Re-read taxonomies (they now have hierarchical IDs): `const updatedRisks = useTaxonomyStore.getState().risks`
4. Generate RCT rows using `generateRCTRows(updatedRisks, updatedProcesses)`
5. Populate scores
6. Set rows: `useRCTStore.getState().setRows(rows)`
7. Generate controls and links
8. Set controls: `useControlsStore.getState().setControls(controls)` and `setControlLinks(links)`
9. Generate control tests and remediation plans
10. Set test data: `useRCTStore.getState().setControlTests(tests)` and `setRemediationPlans(plans)`
11. Generate tickets and links
12. Set tickets: `useTicketsStore.getState().setTickets(tickets)` and `setTicketEntityLinks(links)`
13. Generate comments and KB articles
14. Set collaboration: `useCollaborationStore.getState().setComments(comments)` and `setKnowledgeBaseEntries(articles)`
15. Generate pending changes
16. Set approvals: `useApprovalStore.getState().setPendingChanges(changes)`
17. Enable four-eye globally: `useApprovalStore.getState().updateSettings({ globalEnabled: true })`
18. Generate audit entries
19. Set audit: `useAuditStore.getState().setEntries(auditEntries)`

**Casino-Themed Content Examples:**
- Risks: "Card Counting Detection", "Chip Fraud", "Regulatory Non-Compliance", "Cash Handling Errors"
- Processes: "Table Game Surveillance", "Cage Cash Reconciliation", "Player Verification", "VIP Services"
- Controls: "Daily Cash Count Verification", "Facial Recognition System", "Anti-Money Laundering Checks"
- Audit entries: "Created control 'Daily Cash Count Verification'", "Updated risk 'Chip Fraud' probability from 3 to 4"

**CRITICAL:** Use `store.getState()` pattern for all store access (not hooks). Populate stores in dependency order to maintain referential integrity.
  </action>
  <verify>
1. File exists at `src/utils/mockDataLoader.ts`
2. TypeScript compiles without errors: `npx tsc --noEmit`
3. File exports `loadMockData` function
4. Check import structure is correct
  </verify>
  <done>
- mockDataLoader.ts creates realistic casino-themed demo data
- All store types are properly populated
- Controls linked to multiple rows
- Score distribution is varied
- Pending changes exist for approval demonstration
- Audit entries show representative activity history
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify store setter methods exist</name>
  <files>src/stores/rctStore.ts, src/stores/controlsStore.ts, src/stores/ticketsStore.ts, src/stores/collaborationStore.ts, src/stores/approvalStore.ts, src/stores/auditStore.ts</files>
  <action>
Check that the stores have bulk setter methods needed by mockDataLoader. If any are missing, add them:

**Required setters:**

1. `rctStore`:
   - `setRows(rows: RCTRow[])` - may need to add if only `addRow` exists
   - `setControlTests(tests: ControlTest[])`
   - `setRemediationPlans(plans: RemediationPlan[])`

2. `controlsStore`:
   - `setControls(controls: Control[])`
   - `setControlLinks(links: ControlLink[])`

3. `ticketsStore`:
   - `setTickets(tickets: Ticket[])`
   - `setTicketEntityLinks(links: TicketEntityLink[])`

4. `collaborationStore`:
   - `setComments(comments: Comment[])`
   - `setKnowledgeBaseEntries(entries: KnowledgeBaseEntry[])`

5. `approvalStore`:
   - `setPendingChanges(changes: PendingChange[])`
   - `updateSettings(settings: Partial<ApprovalSettings>)` - likely exists

6. `auditStore`:
   - `setEntries(entries: AuditEntry[])` - to bulk-set audit log for demo

For each missing setter, add a simple implementation:
```typescript
setItems: (items) => set({ items }),
```

If store uses persist middleware, ensure the new state properties are included in the persisted state.
  </action>
  <verify>
1. Verify each setter exists after modifications:
   ```bash
   grep -l "setRows" src/stores/rctStore.ts
   grep -l "setControlTests" src/stores/rctStore.ts
   grep -l "setRemediationPlans" src/stores/rctStore.ts
   grep -l "setControls" src/stores/controlsStore.ts
   grep -l "setControlLinks" src/stores/controlsStore.ts
   grep -l "setTickets" src/stores/ticketsStore.ts
   grep -l "setTicketEntityLinks" src/stores/ticketsStore.ts
   grep -l "setComments" src/stores/collaborationStore.ts
   grep -l "setKnowledgeBaseEntries" src/stores/collaborationStore.ts
   grep -l "setPendingChanges" src/stores/approvalStore.ts
   grep -l "setEntries" src/stores/auditStore.ts
   ```
   Each command should return the file path confirming the method exists.

2. TypeScript compiles without errors after any additions:
   ```bash
   npx tsc --noEmit
   ```
  </verify>
  <done>
- All stores have bulk setter methods for mock data loading
- No TypeScript errors
- Each required setter confirmed via grep verification
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **TypeScript compilation:**
   ```bash
   npx tsc --noEmit
   ```
   Should complete without errors.

2. **Import check:**
   ```bash
   grep -l "loadMockData" src/utils/mockDataLoader.ts
   ```
   Should return the file path.

3. **Store integration check:**
   Verify mockDataLoader imports all required stores:
   ```bash
   grep "useTaxonomyStore" src/utils/mockDataLoader.ts
   grep "useRCTStore" src/utils/mockDataLoader.ts
   grep "useControlsStore" src/utils/mockDataLoader.ts
   grep "useTicketsStore" src/utils/mockDataLoader.ts
   grep "useCollaborationStore" src/utils/mockDataLoader.ts
   grep "useApprovalStore" src/utils/mockDataLoader.ts
   grep "useAuditStore" src/utils/mockDataLoader.ts
   ```

4. **Audit entries included:**
   ```bash
   grep "setEntries" src/utils/mockDataLoader.ts
   ```
   Should confirm audit entries are being set.
</verification>

<success_criteria>
- `src/utils/mockDataLoader.ts` exists and exports `loadMockData()`
- All type imports resolve correctly
- All store getter calls are valid
- Mock data factory functions generate realistic casino-themed content
- Score distribution includes high/medium/low variety
- Controls link to multiple rows
- Pending approval changes included
- Audit entries included with representative activity history
</success_criteria>

<output>
After completion, create `.planning/phases/19-mock-data-loader/19-01-SUMMARY.md`
</output>
