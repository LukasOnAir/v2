---
phase: 20-control-tester-interface
plan: 03
type: execute
wave: 3
depends_on: [20-02]
files_modified:
  - src/utils/mockData.ts
  - src/components/controls/ControlDetailPanel.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Control Tester can see assigned controls in dashboard"
    - "Control Tester can record test results successfully"
    - "Control Tester cannot access taxonomy, matrix, or other restricted pages"
    - "Role switching updates the interface appropriately"
    - "Mock data includes controls assigned to different testers"
  artifacts:
    - path: "src/utils/mockData.ts"
      provides: "Mock controls with tester assignments"
      contains: "assignedTesterId"
    - path: "src/components/controls/ControlDetailPanel.tsx"
      provides: "UI for assigning testers to controls"
      contains: "assignedTesterId"
  key_links:
    - from: "src/pages/TesterDashboardPage.tsx"
      to: "src/stores/controlsStore.ts"
      via: "useControlsStore filter"
      pattern: "assignedTesterId === currentTesterId"
---

<objective>
Complete Control Tester integration with mock data and human verification

Purpose: Add mock data with tester assignments so the feature can be demonstrated, add UI for Risk Manager to assign testers to controls, and verify the complete workflow works as expected.

Output: Mock data generator includes tester assignments, ControlDetailPanel has tester assignment dropdown, all success criteria verified through manual testing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-control-tester-interface/20-RESEARCH.md
@.planning/phases/20-control-tester-interface/20-01-SUMMARY.md
@.planning/phases/20-control-tester-interface/20-02-SUMMARY.md

@src/utils/mockData.ts
@src/components/controls/ControlDetailPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update mock data generator to include tester assignments</name>
  <files>src/utils/mockData.ts</files>
  <action>
    Update the generateMockControls function (or equivalent) to assign testers to controls.

    Add tester assignment logic that distributes controls among testers:
    ```typescript
    // Tester IDs to assign controls to
    const TESTER_IDS = ['tester-1', 'tester-2', 'tester-3']

    // In the control generation logic, add assignedTesterId:
    const control: Control = {
      // ... existing fields ...
      assignedTesterId: TESTER_IDS[index % TESTER_IDS.length],  // Distribute evenly
    }
    ```

    Also ensure some controls remain unassigned (null) for variety:
    ```typescript
    // Leave ~20% unassigned
    assignedTesterId: index % 5 === 0 ? null : TESTER_IDS[index % TESTER_IDS.length],
    ```

    This ensures:
    - Each tester gets approximately 1/3 of assigned controls
    - Some controls remain unassigned
    - Demo shows variety in tester assignments
  </action>
  <verify>Run mock data load, verify controls have different assignedTesterId values</verify>
  <done>Mock data includes controls with varied tester assignments</done>
</task>

<task type="auto">
  <name>Task 2: Add tester assignment UI in ControlDetailPanel</name>
  <files>src/components/controls/ControlDetailPanel.tsx</files>
  <action>
    Add a tester assignment dropdown in the ControlDetailPanel, visible only to Risk Manager role.

    Add the assignment UI in an appropriate section of the panel:
    ```tsx
    {/* Tester Assignment - Risk Manager only */}
    {canEditControlDefinitions && (
      <div className="space-y-2">
        <label className="text-xs font-medium text-text-muted uppercase tracking-wider">
          Assigned Tester
        </label>
        <select
          value={control.assignedTesterId ?? ''}
          onChange={(e) => {
            updateControl(control.id, {
              assignedTesterId: e.target.value || null,
            })
          }}
          className="w-full px-2 py-1.5 bg-surface-elevated border border-surface-border rounded text-sm text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-500"
        >
          <option value="">Unassigned</option>
          <option value="tester-1">Tester 1</option>
          <option value="tester-2">Tester 2</option>
          <option value="tester-3">Tester 3</option>
        </select>
      </div>
    )}
    ```

    Get canEditControlDefinitions from usePermissions.
    Get updateControl from useControlsStore.

    Place this near other control metadata fields (type, description, etc.).
  </action>
  <verify>Run dev server, open control detail panel as Risk Manager, verify tester dropdown appears</verify>
  <done>ControlDetailPanel shows tester assignment dropdown for Risk Manager</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Control Tester Interface with dedicated dashboard, restricted navigation, and tester assignment management</what-built>
  <how-to-verify>
    1. **Test role selection and navigation:**
       - Login to application
       - Select "Control Tester" from role dropdown in header
       - Verify tester ID selector appears (Tester 1, 2, 3)
       - Verify sidebar shows only "My Controls" link
       - Verify notification bell and mock data button are hidden

    2. **Test tester dashboard:**
       - Navigate to /tester or click "My Controls" in sidebar
       - Verify dashboard shows "My Controls" heading
       - Verify stats cards show: Total Assigned, Overdue, Due This Week, Up to Date
       - If no controls assigned, verify empty state message appears

    3. **Test with mock data:**
       - Switch to Manager or Risk Manager role
       - Click database icon to load mock data
       - Confirm loading mock data
       - Switch back to Control Tester role
       - Verify assigned controls appear in dashboard
       - Switch between Tester 1, 2, 3 - verify different controls shown for each

    4. **Test control card functionality:**
       - Click "Show Details" on a control card
       - Verify test procedure is displayed (if set)
       - Verify test history is shown
       - Click "Record Test Result" button
       - Fill out test form: select result, add findings
       - Submit test result
       - Verify test appears in history

    5. **Test due/overdue categorization:**
       - Verify overdue controls (red highlight) appear at top
       - Verify "Due This Week" controls (amber) appear below
       - Verify "Up to Date" controls appear at bottom

    6. **Test tester assignment (as Risk Manager):**
       - Switch to Risk Manager role
       - Go to Controls page or open a control in RCT
       - Open control detail panel
       - Verify "Assigned Tester" dropdown is visible
       - Change tester assignment
       - Switch to Control Tester and verify control moves between testers

    7. **Test permission restrictions:**
       - As Control Tester, verify cannot access:
         - /taxonomy (should see empty sidebar or redirect)
         - /rct
         - /matrix
         - /analytics
         - etc.
       - These routes may still be technically accessible via URL, but navigation is hidden

    8. **Test role switching:**
       - Switch from Control Tester to Risk Manager
       - Verify full sidebar navigation appears
       - Verify redirects to appropriate page (not stuck on /tester)
  </how-to-verify>
  <resume-signal>Type "approved" if all verifications pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All success criteria from phase 20 are verified:
1. New role: "Control Tester" exists in role selector
2. Control Tester can log in with dedicated credentials (demo mode: select from dropdown)
3. Control Tester sees ONLY controls assigned to them
4. Control Tester can record test results for assigned controls
5. Control Tester can view test schedule and upcoming due dates
6. Control Tester cannot modify control definitions, only execute tests
7. Easy demo switch: role selector includes Control Tester option
8. Simplified navigation: minimal sidebar showing only relevant views
9. Dashboard shows tester's assigned controls with due/overdue status
</verification>

<success_criteria>
- All 9 success criteria from phase goal verified
- Mock data includes controls with tester assignments
- ControlDetailPanel allows Risk Manager to assign testers
- Complete workflow from assignment to test recording works
- Role switching provides appropriate interface for each role
</success_criteria>

<output>
After completion, create `.planning/phases/20-control-tester-interface/20-03-SUMMARY.md`
</output>
