---
phase: 21-database-auth-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/supabase/client.ts
  - src/lib/supabase/types.ts
  - .env.local
  - .env.example
autonomous: false
user_setup:
  - service: supabase
    why: "Database and authentication backend"
    env_vars:
      - name: VITE_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: VITE_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    dashboard_config:
      - task: "Create Supabase project if not exists"
        location: "https://supabase.com/dashboard -> New Project"
      - task: "Enable email confirmations"
        location: "Authentication -> Providers -> Email -> Confirm email enabled"

must_haves:
  truths:
    - "Supabase client can be imported and used throughout the app"
    - "Environment variables are loaded at runtime"
    - "TypeScript types exist for database schema"
  artifacts:
    - path: "src/lib/supabase/client.ts"
      provides: "Configured Supabase client"
      exports: ["supabase"]
    - path: "src/lib/supabase/types.ts"
      provides: "Database type definitions"
      exports: ["Database"]
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "VITE_SUPABASE"
  key_links:
    - from: "src/lib/supabase/client.ts"
      to: "import.meta.env"
      via: "Environment variable access"
      pattern: "import\\.meta\\.env\\.VITE_SUPABASE"
---

<objective>
Set up Supabase client infrastructure and install required dependencies.

Purpose: Establish the foundation for all database and auth operations. Without this, nothing else in Phase 21 can work.
Output: Working Supabase client that can be imported anywhere in the app.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-database-auth-foundation/21-RESEARCH.md

# Existing files to understand patterns
@src/stores/uiStore.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Supabase dependencies</name>
  <files>package.json</files>
  <action>
Install the required Supabase packages:
- `@supabase/ssr@^0.8.0` - Server-side auth helpers (replaces deprecated auth-helpers)
- `zod@^4.3.6` - Runtime validation for auth forms

Note: `@supabase/supabase-js@^2.91.1` is already installed per package.json.

Run: `npm install @supabase/ssr@^0.8.0 zod@^4.3.6`

Verify package.json has both new dependencies.
  </action>
  <verify>`npm ls @supabase/ssr zod` shows both packages installed</verify>
  <done>Both @supabase/ssr and zod appear in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client and types</name>
  <files>
    src/lib/supabase/client.ts
    src/lib/supabase/types.ts
    .env.example
  </files>
  <action>
Create directory `src/lib/supabase/` if not exists.

Create `src/lib/supabase/client.ts`:
- Import createClient from @supabase/supabase-js
- Read VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY from import.meta.env
- Throw clear error if env vars missing (helps debugging)
- Export typed supabase client

Create `src/lib/supabase/types.ts`:
- Export Database type placeholder (will be generated after migrations)
- For now, create minimal type that satisfies TypeScript:
```typescript
export type Database = {
  public: {
    Tables: Record<string, never>
    Views: Record<string, never>
    Functions: Record<string, never>
  }
}
```

Create `.env.example`:
```
# Supabase Configuration
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-key
```

DO NOT create .env.local - that contains secrets and will be handled by checkpoint.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>
- src/lib/supabase/client.ts exists and exports `supabase`
- src/lib/supabase/types.ts exists and exports `Database`
- .env.example exists with placeholder values
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what-built>Supabase client infrastructure ready, needs configuration</what-built>
  <action>
User needs to:
1. Create Supabase project at https://supabase.com/dashboard if not exists
2. Go to Project Settings -> API
3. Copy Project URL and anon/public key
4. Create `.env.local` file with:
   ```
   VITE_SUPABASE_URL=https://your-project.supabase.co
   VITE_SUPABASE_ANON_KEY=eyJhbG...your-key
   ```
5. In Supabase Dashboard -> Authentication -> Providers -> Email:
   - Ensure "Confirm email" is enabled
  </action>
  <how-to-verify>
After creating .env.local:
1. Run `npm run dev`
2. Open browser console
3. No errors about missing Supabase environment variables
  </how-to-verify>
  <resume-signal>Type "configured" when .env.local is created and dev server starts without errors</resume-signal>
</task>

</tasks>

<verification>
- [ ] `npm ls @supabase/ssr zod` shows both packages
- [ ] `src/lib/supabase/client.ts` exports supabase client
- [ ] `src/lib/supabase/types.ts` exports Database type
- [ ] `.env.example` exists with VITE_SUPABASE_* placeholders
- [ ] `.env.local` NOT committed to git
- [ ] Dev server starts without Supabase errors
</verification>

<success_criteria>
Supabase client is importable from `@/lib/supabase/client` and environment is configured.
</success_criteria>

<output>
After completion, create `.planning/phases/21-database-auth-foundation/21-01-SUMMARY.md`
</output>
