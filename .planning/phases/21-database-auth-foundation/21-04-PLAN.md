---
phase: 21-database-auth-foundation
plan: 04
type: execute
wave: 3
depends_on: [21-03]
files_modified:
  - src/pages/LoginPage.tsx
  - src/pages/SignupPage.tsx
  - src/pages/ForgotPasswordPage.tsx
  - src/pages/ResetPasswordPage.tsx
  - src/pages/VerifyEmailPage.tsx
  - src/pages/AuthConfirmPage.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can log in with email and password (AUTH-01)"
    - "User can create account with email and password (AUTH-01)"
    - "User can request password reset via email (AUTH-03)"
    - "User can set new password after clicking reset link (AUTH-03)"
    - "Unverified users see instructions to check email (AUTH-02)"
    - "Email verification link completes verification (AUTH-02)"
  artifacts:
    - path: "src/pages/LoginPage.tsx"
      provides: "Login form with Supabase Auth"
      min_lines: 100
    - path: "src/pages/SignupPage.tsx"
      provides: "Registration form with email verification"
      min_lines: 80
    - path: "src/pages/ForgotPasswordPage.tsx"
      provides: "Password reset request form"
      min_lines: 60
    - path: "src/pages/ResetPasswordPage.tsx"
      provides: "New password form after reset link"
      min_lines: 80
    - path: "src/pages/VerifyEmailPage.tsx"
      provides: "Instructions for unverified users"
      min_lines: 40
    - path: "src/pages/AuthConfirmPage.tsx"
      provides: "Email verification link handler"
      min_lines: 50
  key_links:
    - from: "src/pages/LoginPage.tsx"
      to: "src/contexts/AuthContext.tsx"
      via: "useAuth().signIn"
      pattern: "signIn\\("
    - from: "src/pages/SignupPage.tsx"
      to: "src/contexts/AuthContext.tsx"
      via: "useAuth().signUp"
      pattern: "signUp\\("
    - from: "src/App.tsx"
      to: "All auth pages"
      via: "Route definitions"
      pattern: "path=\"/auth/"
---

<objective>
Create authentication UI pages for login, signup, password reset, and email verification.

Purpose: Provide user-facing interfaces for all authentication flows. Users need to be able to create accounts, log in, reset forgotten passwords, and verify their email.
Output: Six pages covering the complete authentication lifecycle.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-database-auth-foundation/21-RESEARCH.md

# Reference for existing styling
@src/pages/LoginPage.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update LoginPage for Supabase Auth</name>
  <files>src/pages/LoginPage.tsx</files>
  <action>
Update the existing LoginPage to use Supabase Auth instead of mock auth.

Key changes:
1. Replace `useUIStore.login` with `useAuth().signIn`
2. Change username field to email field
3. Add Zod validation for email and password
4. Add link to "Forgot password?" and "Create account"
5. Handle auth errors properly (show Supabase error messages)

Keep the existing visual design (motion animations, gradient background, etc.).

Add imports:
```typescript
import { z } from 'zod'
import { useAuth } from '@/contexts/AuthContext'
```

Validation schema:
```typescript
const loginSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
  password: z.string().min(1, 'Password is required'),
})
```

In handleSubmit:
```typescript
const { signIn } = useAuth()

const handleSubmit = async (e: FormEvent) => {
  e.preventDefault()
  setError('')

  const result = loginSchema.safeParse({ email, password })
  if (!result.success) {
    setError(result.error.errors[0].message)
    return
  }

  setIsLoading(true)
  const { error } = await signIn(email, password)
  setIsLoading(false)

  if (error) {
    // Handle specific Supabase auth errors
    if (error.message.includes('Invalid login credentials')) {
      setError('Invalid email or password')
    } else if (error.message.includes('Email not confirmed')) {
      navigate('/verify-email', { state: { email } })
      return
    } else {
      setError(error.message)
    }
    return
  }

  navigate(from, { replace: true })
}
```

Add links below the form:
- "Forgot your password?" linking to /forgot-password
- "Don't have an account? Sign up" linking to /signup
  </action>
  <verify>LoginPage uses useAuth().signIn instead of useUIStore.login</verify>
  <done>LoginPage updated with Supabase Auth, email validation, and navigation links</done>
</task>

<task type="auto">
  <name>Task 2: Create SignupPage</name>
  <files>src/pages/SignupPage.tsx</files>
  <action>
Create new SignupPage with similar design to LoginPage.

Requirements:
- Email input with validation
- Password input with min 8 characters
- Confirm password field (must match)
- Submit calls useAuth().signUp
- On success, show message "Check your email for verification link"
- Link to "Already have an account? Sign in"

Validation:
```typescript
const signupSchema = z.object({
  email: z.string().email('Please enter a valid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Passwords don't match",
  path: ['confirmPassword'],
})
```

After successful signup, show success state (not navigate away):
```typescript
const [isSuccess, setIsSuccess] = useState(false)

// After signUp success:
setIsSuccess(true)

// Render success message:
if (isSuccess) {
  return (
    // Nice centered card saying "Check your email"
    // With email icon and instructions
    // Link to go to login page
  )
}
```
  </action>
  <verify>SignupPage.tsx exists and uses useAuth().signUp</verify>
  <done>SignupPage created with password confirmation and email verification instructions</done>
</task>

<task type="auto">
  <name>Task 3: Create password reset pages</name>
  <files>
    src/pages/ForgotPasswordPage.tsx
    src/pages/ResetPasswordPage.tsx
  </files>
  <action>
Create two pages for the password reset flow (AUTH-03).

**ForgotPasswordPage.tsx:**
- Email input field
- Calls useAuth().resetPassword(email)
- On success, shows "Check your email for reset link"
- Link to "Back to login"

```typescript
const { resetPassword } = useAuth()

const handleSubmit = async (e: FormEvent) => {
  const { error } = await resetPassword(email)
  if (error) {
    setError(error.message)
    return
  }
  setIsSuccess(true)
}
```

**ResetPasswordPage.tsx:**
- This page is loaded from the reset email link
- Supabase adds tokens to URL hash/params
- User enters new password (with confirmation)
- Calls useAuth().updatePassword(newPassword)
- On success, redirect to login with success message

The reset link from Supabase includes tokens. When user lands on this page, Supabase client automatically handles the token exchange.

```typescript
const { updatePassword } = useAuth()
const navigate = useNavigate()

const handleSubmit = async (e: FormEvent) => {
  if (password !== confirmPassword) {
    setError("Passwords don't match")
    return
  }

  const { error } = await updatePassword(password)
  if (error) {
    setError(error.message)
    return
  }

  // Redirect to login with success message
  navigate('/login', { state: { message: 'Password reset successfully. Please log in.' } })
}
```
  </action>
  <verify>Both files exist and use useAuth().resetPassword and useAuth().updatePassword</verify>
  <done>
- ForgotPasswordPage requests password reset email
- ResetPasswordPage allows setting new password
  </done>
</task>

</tasks>

<verification>
- [ ] LoginPage uses useAuth().signIn with email (not username)
- [ ] LoginPage has Zod validation
- [ ] LoginPage has links to forgot password and signup
- [ ] SignupPage validates password length and confirmation
- [ ] SignupPage shows success message after signup
- [ ] ForgotPasswordPage sends reset email
- [ ] ResetPasswordPage allows setting new password
- [ ] All pages use consistent visual design
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
Users can sign up, log in, and reset forgotten passwords through proper UI flows.
</success_criteria>

<output>
After completion, create `.planning/phases/21-database-auth-foundation/21-04-SUMMARY.md`
</output>
