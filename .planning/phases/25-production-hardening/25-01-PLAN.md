---
phase: 25-production-hardening
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/error/ErrorFallback.tsx
  - src/components/error/RouteErrorBoundary.tsx
  - src/App.tsx
  - src/main.tsx
autonomous: true

must_haves:
  truths:
    - "Application errors are caught by error boundaries instead of crashing"
    - "Users see friendly error messages instead of stack traces"
    - "Error boundary resets automatically when navigating to different route"
    - "Async errors from useEffect/event handlers are caught via useErrorBoundary hook"
  artifacts:
    - path: "src/components/error/ErrorFallback.tsx"
      provides: "User-friendly error fallback UI"
      min_lines: 40
    - path: "src/components/error/RouteErrorBoundary.tsx"
      provides: "Route-level error boundary with reset capability"
      exports: ["RouteErrorBoundary"]
    - path: "src/App.tsx"
      provides: "App-level error boundary wrapping all routes"
      contains: "ErrorBoundary"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/error/ErrorFallback.tsx"
      via: "FallbackComponent prop"
      pattern: "FallbackComponent.*ErrorFallback"
    - from: "src/App.tsx"
      to: "react-error-boundary"
      via: "import"
      pattern: "import.*ErrorBoundary.*from.*react-error-boundary"
---

<objective>
Implement layered error boundaries for graceful error handling across the application.

Purpose: Prevent entire app crashes from component errors and show user-friendly error messages instead of stack traces.
Output: Error boundary components and App.tsx integration that catches all React rendering errors.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-production-hardening/25-RESEARCH.md
@src/App.tsx
@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-error-boundary and create ErrorFallback component</name>
  <files>
    - package.json
    - src/components/error/ErrorFallback.tsx
  </files>
  <action>
    1. Install react-error-boundary:
       ```bash
       npm install react-error-boundary
       ```

    2. Create src/components/error/ directory

    3. Create ErrorFallback.tsx with:
       - Props: { error: Error, resetErrorBoundary: () => void }
       - Full-screen centered layout matching project styling (bg-surface-base, etc.)
       - AlertCircle icon from lucide-react
       - Friendly heading "Something went wrong"
       - Friendly message "We encountered an unexpected error. Our team has been notified."
       - In DEV mode only (import.meta.env.DEV): show error.message in red preformatted block
       - "Try Again" button (accent-500 bg) that calls resetErrorBoundary
       - "Go Home" link (surface-elevated bg) that navigates to "/"
       - Use existing Tailwind classes from project (text-text-primary, text-text-secondary, etc.)

    Match the styling from 25-RESEARCH.md example but adapt to existing project conventions.
  </action>
  <verify>
    - `npm ls react-error-boundary` shows installed
    - File src/components/error/ErrorFallback.tsx exists
    - Component exports ErrorFallback function
  </verify>
  <done>
    ErrorFallback component exists with user-friendly error UI, dev-mode error details, and reset/home actions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create RouteErrorBoundary wrapper and integrate into App.tsx</name>
  <files>
    - src/components/error/RouteErrorBoundary.tsx
    - src/App.tsx
  </files>
  <action>
    1. Create RouteErrorBoundary.tsx:
       - Wrapper component using ErrorBoundary from react-error-boundary
       - Uses ErrorFallback as FallbackComponent
       - Uses useLocation from react-router to get pathname
       - resetKeys includes location.pathname (auto-reset on navigation)
       - onError callback logs structured error info:
         ```typescript
         console.error(JSON.stringify({
           level: 'error',
           type: 'react_error_boundary',
           error: error.message,
           stack: error.stack,
           componentStack: info.componentStack,
           timestamp: new Date().toISOString(),
         }))
         ```
       - Renders children wrapped in ErrorBoundary

    2. Update App.tsx:
       - Import ErrorBoundary from 'react-error-boundary'
       - Import ErrorFallback from '@/components/error/ErrorFallback'
       - Wrap the entire return (AuthProvider and everything inside) with ErrorBoundary
         - FallbackComponent={ErrorFallback}
         - onError callback with same structured logging as above

    The structure should be:
    ```
    <ErrorBoundary FallbackComponent={ErrorFallback} onError={...}>
      <AuthProvider>
        <BrowserRouter>
          ...
        </BrowserRouter>
        <Toaster ... />
      </AuthProvider>
    </ErrorBoundary>
    ```

    Note: Do NOT add route-level boundaries yet - the app-level boundary is sufficient for MVP.
    Route-level boundaries can be added later if specific routes need isolated error handling.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - App.tsx imports ErrorBoundary and ErrorFallback
    - ErrorBoundary wraps AuthProvider in App.tsx
  </verify>
  <done>
    App.tsx has app-level error boundary that catches all React rendering errors and shows friendly fallback UI.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `npm run build` succeeds
2. `npm run dev` starts without errors
3. Manually test error boundary:
   - In a component, temporarily add: `throw new Error('Test error')`
   - Error fallback should display instead of crash
   - "Try Again" button should attempt to re-render
   - "Go Home" link should navigate to /
4. In production mode: no stack trace visible to user
5. In dev mode: error message visible in fallback
</verification>

<success_criteria>
- react-error-boundary installed
- ErrorFallback component shows user-friendly error UI
- App-level ErrorBoundary wraps entire app in App.tsx
- Structured error logging to console on boundary trigger
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-production-hardening/25-01-SUMMARY.md`
</output>
