---
phase: 28-matrix-invertible-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/matrixStore.ts
autonomous: true

must_haves:
  truths:
    - "Matrix store has isInverted boolean state"
    - "Matrix store has riskLabelMode state with three options"
    - "Matrix store has processLabelMode state with three options"
    - "All new settings persist to localStorage"
  artifacts:
    - path: "src/stores/matrixStore.ts"
      provides: "Extended MatrixState with display settings"
      contains: "isInverted"
  key_links:
    - from: "src/stores/matrixStore.ts"
      to: "localStorage"
      via: "persist middleware partialize"
      pattern: "partialize.*isInverted"
---

<objective>
Add display configuration state to matrixStore for matrix inversion and label display modes.

Purpose: Enable user-configurable matrix orientation and label formatting without modifying UI components yet.
Output: Extended matrixStore with `isInverted`, `riskLabelMode`, and `processLabelMode` state properties and setters.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/stores/matrixStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add LabelMode type and display settings to MatrixState</name>
  <files>src/stores/matrixStore.ts</files>
  <action>
1. Define a LabelMode type above the MatrixState interface:
   ```typescript
   export type LabelMode = 'id' | 'name' | 'both'
   ```

2. Extend the MatrixState interface with new properties:
   - `isInverted: boolean` - when true, risks become rows, processes become columns
   - `riskLabelMode: LabelMode` - controls risk label display format
   - `processLabelMode: LabelMode` - controls process label display format

3. Add corresponding setters:
   - `setIsInverted: (inverted: boolean) => void`
   - `setRiskLabelMode: (mode: LabelMode) => void`
   - `setProcessLabelMode: (mode: LabelMode) => void`

4. Add default values in the store initialization:
   - `isInverted: false` (default: processes as rows, risks as columns)
   - `riskLabelMode: 'both'` (default: show "1.2: Risk Name")
   - `processLabelMode: 'both'` (default: show "1.2: Process Name")

5. Implement the setter actions using immer pattern (matching existing setters):
   ```typescript
   setIsInverted: (inverted) =>
     set((state) => {
       state.isInverted = inverted
     }),
   setRiskLabelMode: (mode) =>
     set((state) => {
       state.riskLabelMode = mode
     }),
   setProcessLabelMode: (mode) =>
     set((state) => {
       state.processLabelMode = mode
     }),
   ```

6. Update the partialize function to persist all new settings:
   ```typescript
   partialize: (state) => ({
     zoomLevel: state.zoomLevel,
     showNumbers: state.showNumbers,
     weights: state.weights,
     expandedViewColumns: state.expandedViewColumns,
     isInverted: state.isInverted,
     riskLabelMode: state.riskLabelMode,
     processLabelMode: state.processLabelMode,
   }),
   ```

Keep the existing storage name 'riskguard-matrix' - Zustand persist will merge new keys.
  </action>
  <verify>
Run TypeScript compiler: `npx tsc --noEmit` should pass with no errors in matrixStore.ts
  </verify>
  <done>
MatrixState has isInverted, riskLabelMode, processLabelMode with setters, all persisted to localStorage
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Store exports LabelMode type and new state properties
3. New settings appear in localStorage under 'riskguard-matrix' key after first access
</verification>

<success_criteria>
- LabelMode type exported from matrixStore
- isInverted boolean with setIsInverted setter
- riskLabelMode and processLabelMode with respective setters
- All three new properties included in partialize for persistence
- Existing store functionality unchanged (zoomLevel, showNumbers, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/28-matrix-invertible-display/28-01-SUMMARY.md`
</output>
