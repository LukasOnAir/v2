---
phase: 28-matrix-invertible-display
plan: 02
type: execute
wave: 2
depends_on: ["28-01"]
files_modified:
  - src/components/matrix/MatrixToolbar.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle matrix inversion with a button/switch"
    - "User can select risk label mode from dropdown"
    - "User can select process label mode from dropdown"
    - "Controls reflect current store state on load"
  artifacts:
    - path: "src/components/matrix/MatrixToolbar.tsx"
      provides: "Matrix display configuration UI controls"
      contains: "setIsInverted"
  key_links:
    - from: "src/components/matrix/MatrixToolbar.tsx"
      to: "src/stores/matrixStore.ts"
      via: "useMatrixStore hook"
      pattern: "useMatrixStore.*isInverted.*riskLabelMode.*processLabelMode"
---

<objective>
Add toolbar controls for matrix inversion toggle and label mode selectors.

Purpose: Give users interactive controls to configure matrix display without touching the grid rendering logic.
Output: Extended MatrixToolbar with inversion toggle button and two label mode dropdowns.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-matrix-invertible-display/28-01-SUMMARY.md
@src/components/matrix/MatrixToolbar.tsx
@src/stores/matrixStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inversion toggle and label mode selectors to MatrixToolbar</name>
  <files>src/components/matrix/MatrixToolbar.tsx</files>
  <action>
1. Import the new store state and LabelMode type:
   ```typescript
   import { useMatrixStore, type LabelMode } from '@/stores/matrixStore'
   ```

2. Add Lucide icons for the toggle:
   ```typescript
   import { Download, ArrowLeftRight } from 'lucide-react'
   ```

3. Destructure new state from useMatrixStore:
   ```typescript
   const {
     zoomLevel, setZoomLevel,
     isInverted, setIsInverted,
     riskLabelMode, setRiskLabelMode,
     processLabelMode, setProcessLabelMode,
   } = useMatrixStore()
   ```

4. Create a label options array for the dropdowns:
   ```typescript
   const labelOptions: { value: LabelMode; label: string }[] = [
     { value: 'id', label: 'ID only' },
     { value: 'name', label: 'Name only' },
     { value: 'both', label: 'ID + Name' },
   ]
   ```

5. Add the inversion toggle button AFTER the zoom controls, BEFORE the export button:
   ```tsx
   <button
     onClick={() => setIsInverted(!isInverted)}
     className={`flex items-center gap-1.5 px-3 py-1.5 text-sm border rounded transition-colors ${
       isInverted
         ? 'bg-accent-500/20 border-accent-500 text-accent-400'
         : 'bg-surface-overlay border-surface-border hover:bg-surface-border'
     }`}
     title={isInverted ? 'Risks as rows, Processes as columns' : 'Processes as rows, Risks as columns'}
   >
     <ArrowLeftRight size={14} />
     {isInverted ? 'Inverted' : 'Normal'}
   </button>
   ```

6. Add a divider and label mode controls section:
   ```tsx
   <div className="h-6 w-px bg-surface-border" />

   <div className="flex items-center gap-2">
     <label className="text-sm text-text-secondary">Labels:</label>
     <select
       value={riskLabelMode}
       onChange={(e) => setRiskLabelMode(e.target.value as LabelMode)}
       className="px-2 py-1 text-sm bg-surface-overlay border border-surface-border rounded focus:outline-none focus:ring-1 focus:ring-accent-500"
       title="Risk label format"
     >
       {labelOptions.map((opt) => (
         <option key={opt.value} value={opt.value}>
           Risk: {opt.label}
         </option>
       ))}
     </select>
     <select
       value={processLabelMode}
       onChange={(e) => setProcessLabelMode(e.target.value as LabelMode)}
       className="px-2 py-1 text-sm bg-surface-overlay border border-surface-border rounded focus:outline-none focus:ring-1 focus:ring-accent-500"
       title="Process label format"
     >
       {labelOptions.map((opt) => (
         <option key={opt.value} value={opt.value}>
           Process: {opt.label}
         </option>
       ))}
     </select>
   </div>
   ```

7. Ensure the toolbar layout flows properly with flexbox:
   - The existing `flex items-center justify-between gap-4` on the container works
   - Group the left-side controls together if needed with a wrapping div
   - Keep Export button on the right side

Final layout structure:
```
[Zoom slider] | [Invert toggle] | [Risk Label dropdown] [Process Label dropdown] ... [Export button]
```
  </action>
  <verify>
1. Run `npx tsc --noEmit` - no TypeScript errors
2. Manual check: Open the application, navigate to Matrix page, verify all controls render and are interactive
  </verify>
  <done>
MatrixToolbar displays inversion toggle button and two label mode dropdowns, all wired to matrixStore
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. All three new controls visible in toolbar
3. Inversion toggle changes visual state (highlighted when active)
4. Label dropdowns show current selection from store
5. Changing any control updates the store (verify in React DevTools or by checking the Matrix page)
</verification>

<success_criteria>
- Inversion toggle button with ArrowLeftRight icon
- Risk label mode dropdown with 3 options
- Process label mode dropdown with 3 options
- All controls read from and write to matrixStore
- Visual feedback on inversion toggle (highlighted when inverted)
</success_criteria>

<output>
After completion, create `.planning/phases/28-matrix-invertible-display/28-02-SUMMARY.md`
</output>
