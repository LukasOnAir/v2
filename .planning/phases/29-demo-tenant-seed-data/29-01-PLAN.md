---
phase: 29-demo-tenant-seed-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/seed-scripts/29-01-risk-taxonomy.sql
autonomous: true

must_haves:
  truths:
    - "Risk taxonomy has 5 L1 categories (Strategic, Operational, Financial, Compliance, Technology)"
    - "Each L1 category has 3-4 L2 subcategories"
    - "L2 categories have L3 children, some with L4/L5 for depth showcase"
    - "All nodes belong to tenant 5ea03edb-6e79-4b62-bd36-39f1963d0640"
    - "hierarchical_id auto-generated correctly (1, 1.1, 1.1.1, etc.)"
  artifacts:
    - path: "supabase/seed-scripts/29-01-risk-taxonomy.sql"
      provides: "Risk taxonomy seed SQL"
      contains: "INSERT INTO public.taxonomy_nodes"
  key_links:
    - from: "supabase/seed-scripts/29-01-risk-taxonomy.sql"
      to: "public.taxonomy_nodes"
      via: "INSERT statements"
      pattern: "type = 'risk'"
---

<objective>
Create SQL seed script for generic risk taxonomy (L1-L5) in demo tenant.

Purpose: Populate the risk taxonomy with generic enterprise risk categories that showcase all 5 hierarchy levels without being industry-specific.

Output: SQL script that can be executed via Supabase SQL Editor or psql to insert ~50-60 risk taxonomy nodes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@supabase/migrations/00013_taxonomy_nodes.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create risk taxonomy seed SQL script</name>
  <files>supabase/seed-scripts/29-01-risk-taxonomy.sql</files>
  <action>
Create SQL seed script for risk taxonomy. The script must:

1. Create directory `supabase/seed-scripts/` if it does not exist

2. Write SQL with this structure:
   - Header comment explaining purpose and tenant ID
   - Set tenant_id variable: `'5ea03edb-6e79-4b62-bd36-39f1963d0640'::uuid`
   - Delete any existing risk taxonomy nodes for this tenant (clean slate)
   - Insert nodes in hierarchical order (parents before children)

3. Risk taxonomy structure (generic, not industry-specific):

   **L1 Categories (5 total):**
   - Strategic Risk
   - Operational Risk
   - Financial Risk
   - Compliance Risk
   - Technology Risk

   **L2 under Strategic Risk (3):**
   - Market Risk
   - Business Model Risk
   - Growth Risk

   **L2 under Operational Risk (4):**
   - Process Risk
   - People Risk
   - Supply Chain Risk
   - Physical Asset Risk

   **L2 under Financial Risk (3):**
   - Liquidity Risk
   - Credit Risk
   - Market Price Risk

   **L2 under Compliance Risk (3):**
   - Regulatory Risk
   - Legal Risk
   - Data Privacy Risk

   **L2 under Technology Risk (3):**
   - Cybersecurity Risk
   - System Risk
   - Data Risk

   **L3 nodes (3-4 per L2, ~50 total):**
   Add specific risk types under each L2. Examples:
   - Market Risk -> Competition, Market Disruption, Customer Concentration, Pricing Pressure
   - People Risk -> Key Person Dependency, Skills Gap, Employee Misconduct, Retention
   - Cybersecurity Risk -> Data Breach, Ransomware, Phishing, Insider Threat

   **L4/L5 nodes (select few to show depth):**
   Add 2-3 branches that go to L4 or L5 to showcase deep hierarchy:
   - Technology Risk -> Cybersecurity Risk -> Data Breach -> External Attack -> APT (L5)
   - Compliance Risk -> Regulatory Risk -> Industry Specific -> License Requirements -> Annual Renewal (L5)

4. SQL pattern for inserts (trigger generates hierarchical_id and path):
   ```sql
   -- Use CTEs or DO block to capture parent IDs
   WITH l1_strategic AS (
     INSERT INTO public.taxonomy_nodes (tenant_id, type, parent_id, name, description, sort_order)
     VALUES (tenant_id, 'risk', NULL, 'Strategic Risk', 'Risks affecting...', 1)
     RETURNING id
   ),
   l2_market AS (
     INSERT INTO public.taxonomy_nodes (tenant_id, type, parent_id, name, description, sort_order)
     SELECT tenant_id, 'risk', id, 'Market Risk', 'External market...', 1
     FROM l1_strategic
     RETURNING id
   )
   -- Continue pattern...
   ```

   Or use DO block with variables:
   ```sql
   DO $$
   DECLARE
     tenant_id UUID := '5ea03edb-6e79-4b62-bd36-39f1963d0640';
     l1_strategic UUID;
     l2_market UUID;
     -- etc
   BEGIN
     INSERT INTO public.taxonomy_nodes (tenant_id, type, parent_id, name, description, sort_order)
     VALUES (tenant_id, 'risk', NULL, 'Strategic Risk', 'Risks affecting long-term goals', 1)
     RETURNING id INTO l1_strategic;

     INSERT INTO public.taxonomy_nodes (tenant_id, type, parent_id, name, description, sort_order)
     VALUES (tenant_id, 'risk', l1_strategic, 'Market Risk', 'External market risks', 1)
     RETURNING id INTO l2_market;
     -- etc
   END $$;
   ```

5. Include meaningful descriptions for each node (1 sentence)

6. Set sort_order for proper sibling ordering (1, 2, 3, etc.)

7. Total nodes: ~55-65 risk taxonomy nodes
  </action>
  <verify>
Run SQL in Supabase SQL Editor. Verify:
- `SELECT COUNT(*) FROM taxonomy_nodes WHERE tenant_id = '5ea03edb-6e79-4b62-bd36-39f1963d0640' AND type = 'risk'` returns 55-65
- `SELECT hierarchical_id, name FROM taxonomy_nodes WHERE type = 'risk' ORDER BY hierarchical_id` shows correct hierarchy
- L5 nodes exist (hierarchical_id like '%.%.%.%.%')
  </verify>
  <done>Risk taxonomy seed script creates 55-65 nodes with proper L1-L5 hierarchy, auto-generated hierarchical_ids, and meaningful descriptions</done>
</task>

</tasks>

<verification>
- [ ] SQL script exists at supabase/seed-scripts/29-01-risk-taxonomy.sql
- [ ] Script is syntactically valid SQL
- [ ] Uses hardcoded tenant_id for demo tenant
- [ ] Deletes existing risk nodes before inserting (clean slate)
- [ ] Creates 5 L1 categories
- [ ] Creates ~16 L2 categories (3-4 per L1)
- [ ] Creates ~50 L3 categories (3-4 per L2)
- [ ] Creates 2-3 L4/L5 branches to showcase depth
- [ ] Each node has name, description, sort_order
</verification>

<success_criteria>
SQL script can be executed in Supabase SQL Editor to populate risk taxonomy for demo tenant. Query shows hierarchical structure with proper hierarchical_ids generated by trigger.
</success_criteria>

<output>
After completion, create `.planning/phases/29-demo-tenant-seed-data/29-01-SUMMARY.md`
</output>
