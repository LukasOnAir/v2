# Plan 35-01: Controls Hub Icon and Column Cleanup

## Frontmatter

```yaml
phase: 35
plan: 01
title: Controls Hub Icon and Column Cleanup
wave: 1
depends_on: []
files_modified:
  - src/components/controls/ControlsTable.tsx
autonomous: true
```

## Objective

Update ControlsTable to:
1. Remove "Linked Risks" count column
2. Remove "Risk Names" column
3. Add Settings2 icon with linked-risk count to LEFT of control name (always visible, matching RCT pattern)

## Context

**Current state (ControlsTable.tsx):**
- Control Name column: Text + PanelRight icon on right (hover-only)
- Linked Risks column: Shows count like "3 risks"
- Risk Names column: Shows names like "Risk A, Risk B +1 more"

**Target state:**
- Control Name column: Settings2 icon + count on LEFT (always visible) + clickable text
- No Linked Risks column
- No Risk Names column

**RCT pattern to match (RCTTable.tsx:792-799):**
```tsx
<button
  onClick={() => openControlPanel(row.original.id)}
  className="flex items-center gap-1.5 px-2 py-1 text-xs rounded bg-surface-overlay hover:bg-surface-border transition-colors"
>
  <Settings2 size={14} />
  <span>{totalCount}</span>
</button>
```

## Tasks

<task id="1">
<title>Update imports in ControlsTable.tsx</title>
<file>src/components/controls/ControlsTable.tsx</file>
<action>edit</action>
<details>
Replace `PanelRight` with `Settings2` in lucide-react imports.
Remove `Link2` from imports (no longer used after column removal).

Change line 10 from:
```tsx
import { ChevronUp, ChevronDown, Link2, PanelRight, Trash2, Loader2 } from 'lucide-react'
```

To:
```tsx
import { ChevronUp, ChevronDown, Settings2, Trash2, Loader2 } from 'lucide-react'
```
</details>
</task>

<task id="2">
<title>Update Control Name column with icon+count on left</title>
<file>src/components/controls/ControlsTable.tsx</file>
<action>edit</action>
<details>
Replace the Control Name column cell (lines 87-104) with new pattern:
- Settings2 icon + linkCount button on LEFT (always visible)
- Control name text on RIGHT (also clickable)
- Both icon-button and text open the same detail panel

New column definition:
```tsx
{
  accessorKey: 'name',
  header: 'Control Name',
  cell: ({ row }) => (
    <div className="flex items-center gap-2">
      <button
        onClick={() => onControlClick(row.original.id)}
        className="flex items-center gap-1.5 px-2 py-1 text-xs rounded bg-surface-overlay hover:bg-surface-border transition-colors"
        title={`${row.original.linkCount} linked risk${row.original.linkCount === 1 ? '' : 's'}`}
      >
        <Settings2 size={14} />
        <span>{row.original.linkCount}</span>
      </button>
      <button
        onClick={() => onControlClick(row.original.id)}
        className={`text-left text-accent-400 hover:underline ${row.original.name ? '' : 'text-text-muted italic'}`}
      >
        {row.original.name || '(unnamed)'}
      </button>
    </div>
  ),
},
```
</details>
</task>

<task id="3">
<title>Remove Linked Risks count column</title>
<file>src/components/controls/ControlsTable.tsx</file>
<action>edit</action>
<details>
Delete the entire "Linked Risks" column definition (lines 122-138):
```tsx
{
  accessorKey: 'linkCount',
  header: () => (
    <span className="flex items-center gap-1">
      <Link2 size={14} />
      Linked Risks
    </span>
  ),
  cell: ({ row }) => {
    const count = row.original.linkCount
    return (
      <span className={count > 0 ? 'text-text-primary' : 'text-text-muted'}>
        {count} {count === 1 ? 'risk' : 'risks'}
      </span>
    )
  },
},
```
</details>
</task>

<task id="4">
<title>Remove Risk Names column</title>
<file>src/components/controls/ControlsTable.tsx</file>
<action>edit</action>
<details>
Delete the entire "Risk Names" column definition (lines 139-152):
```tsx
{
  accessorKey: 'linkedRisks',
  header: 'Risk Names',
  cell: ({ row }) => {
    const risks = row.original.linkedRisks
    if (risks.length === 0) return <span className="text-text-muted">â€”</span>
    if (risks.length <= 2) return <span className="text-text-secondary">{risks.join(', ')}</span>
    return (
      <span className="text-text-secondary" title={risks.join(', ')}>
        {risks.slice(0, 2).join(', ')} +{risks.length - 2} more
      </span>
    )
  },
},
```
</details>
</task>

<task id="5">
<title>Clean up unused linkedRisks from EnrichedControl</title>
<file>src/components/controls/ControlsTable.tsx</file>
<action>edit</action>
<details>
The `linkedRisks` field is no longer displayed. Remove it from:

1. EnrichedControl interface (line 22):
```tsx
// Remove: linkedRisks: string[]
interface EnrichedControl extends Control {
  linkCount: number
}
```

2. Data mapping (lines 72-75, 80):
```tsx
// Remove linkedRisks computation from useMemo
return controls.map(control => {
  const links = controlLinks.filter(l => l.controlId === control.id)
  return {
    ...control,
    linkCount: links.length,
  }
})
```

This removes the unused `linkedRows` and `linkedRisks` computation.
</details>
</task>

## Verification

```bash
# TypeScript check
npx tsc --noEmit

# Visual verification
npm run dev
# Navigate to Controls Hub (/controls)
# Verify:
# 1. Settings2 icon + count appears LEFT of control name
# 2. Both icon and text are clickable (open detail panel)
# 3. No "Linked Risks" column
# 4. No "Risk Names" column
# 5. Count in icon matches actual linked risks
```

## Must Haves (Goal-Backward)

- [ ] Settings2 icon visible on left of every control name (not on hover)
- [ ] Count badge shows number of linked risks
- [ ] Both icon-button and name text open control detail panel
- [ ] "Linked Risks" column removed
- [ ] "Risk Names" column removed
- [ ] No TypeScript errors
