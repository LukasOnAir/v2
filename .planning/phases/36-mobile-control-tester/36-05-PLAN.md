---
phase: 36-mobile-control-tester
plan: 05
type: execute
wave: 3
depends_on: ["36-01", "36-02", "36-03", "36-04"]
files_modified:
  - src/pages/TesterDashboardPage.tsx
  - src/components/tester/TestWizard.tsx
autonomous: false

must_haves:
  truths:
    - "Test wizard completes successfully on mobile device"
    - "Photo upload works from mobile camera"
    - "Offline submission queues and syncs correctly"
    - "PWA installs to home screen"
  artifacts:
    - path: "src/pages/TesterDashboardPage.tsx"
      provides: "Mobile-optimized tester dashboard"
    - path: "src/components/tester/TestWizard.tsx"
      provides: "Polished wizard with all features working"
  key_links:
    - from: "TestWizard"
      to: "PhotoUpload"
      via: "evidence step"
      pattern: "<PhotoUpload"
    - from: "TestWizard"
      to: "offlineQueue"
      via: "offline submission"
      pattern: "queueTestSubmission"
---

<objective>
Polish the mobile experience and verify all features work end-to-end on real mobile devices.

Purpose: Ensure first-line employees have a smooth, friction-free experience completing control tests on their phones.
Output: Verified mobile experience with any bugs fixed.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-mobile-control-tester/36-RESEARCH.md
@.planning/phases/36-mobile-control-tester/36-01-SUMMARY.md
@.planning/phases/36-mobile-control-tester/36-02-SUMMARY.md
@.planning/phases/36-mobile-control-tester/36-03-SUMMARY.md
@.planning/phases/36-mobile-control-tester/36-04-SUMMARY.md
@src/pages/TesterDashboardPage.tsx
@src/components/tester/TestWizard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mobile polish and accessibility review</name>
  <files>src/pages/TesterDashboardPage.tsx, src/components/tester/TestWizard.tsx, src/components/tester/TesterControlCard.tsx</files>
  <action>
Review and fix mobile UX issues:

1. TesterDashboardPage:
   - Ensure header is sticky on scroll (sticky top-0 z-10)
   - OfflineIndicator positioned correctly (doesn't overlap content)
   - Stats cards readable on small screens (text-xs on mobile)
   - Control cards have adequate spacing

2. TestWizard:
   - Back button has proper touch target (min-h-[48px] min-w-[48px])
   - Close (X) button visible and accessible
   - Progress bar clearly visible
   - Result buttons (Pass/Fail/Partial) have adequate size and spacing
   - Step transitions smooth (no jarring jumps)
   - Keyboard doesn't cover inputs (scroll into view on focus)

3. TesterControlCard:
   - "Record Test Result" button prominent and easy to tap
   - Card content readable without expanding
   - Expand/collapse button meets touch target size

4. General:
   - All interactive elements have min-h-[44px] or min-h-[48px]
   - Text is legible (minimum 14px/0.875rem on mobile)
   - Color contrast passes WCAG AA
   - Focus states visible for accessibility

5. Specific fixes from research notes:
   - Ensure no console errors on mobile Safari
   - Test viewport meta tag is correct in index.html
   - Verify safe area insets for notched phones (safe-area-inset-* if needed)
  </action>
  <verify>
    - Run `npm run dev` and test on Chrome mobile emulator
    - All buttons meet 44px minimum touch target
    - No horizontal scroll on mobile viewport
    - Text readable without zooming
  </verify>
  <done>
    - All touch targets meet 44px minimum
    - Text legible on mobile
    - No horizontal overflow
    - Keyboard handling works correctly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete mobile control tester experience including:
- PWA with install capability and offline caching
- Step-by-step test wizard with 4 guided steps
- Photo upload from mobile camera
- Offline queue with automatic sync
- Visual offline/pending indicators
- Reminder email infrastructure (if Resend configured)
  </what-built>
  <how-to-verify>
**On a real mobile device (or emulator):**

1. **PWA Install Test:**
   - Open app in mobile Chrome/Safari
   - Check for "Add to Home Screen" option
   - Install and verify app icon appears
   - Open installed app - should launch in standalone mode

2. **Test Wizard Flow:**
   - Navigate to /tester (or switch to tester role)
   - Click any control card
   - Click "Record Test Result"
   - Complete all 4 wizard steps:
     - Step 1: Review control info, tap Next
     - Step 2: Tap Pass/Fail/Partial, tap Next
     - Step 3: Tap "Take Photo" (camera should open), add optional notes, tap Next
     - Step 4: Review summary, tap Submit
   - Verify success toast and wizard closes

3. **Offline Test:**
   - Enable airplane mode on device
   - Verify "Offline" badge appears
   - Submit a test through wizard
   - Verify "Test saved offline" toast
   - Disable airplane mode
   - Verify "Syncing..." toast followed by success
   - Check database for synced test record

4. **Photo Upload Test:**
   - Go through wizard to evidence step
   - Tap "Take Photo"
   - Camera should open (rear camera by default)
   - Take photo and confirm
   - Photo preview should appear
   - Complete wizard
   - Check Supabase Storage bucket for uploaded image

5. **General Mobile UX:**
   - All buttons easily tappable
   - No accidental taps on wrong elements
   - Text readable without zooming
   - Smooth scrolling
   - Keyboard doesn't obscure inputs

**Expected Results:**
- All 5 test scenarios pass
- No crashes or errors
- Smooth, intuitive experience
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any issues found.
If issues found, they will be fixed before marking phase complete.
  </resume-signal>
</task>

</tasks>

<verification>
Phase 36 success criteria from roadmap:
1. Control testers can view and complete assigned tests on mobile phones
2. Tests broken into small, actionable steps with clear instructions
3. Weekly reminder notifications sent to testers with pending tests
4. Progress tracking shows completed steps and overall test status
5. Photo/document upload capability for test evidence
6. Offline-capable: testers can work without constant connectivity
7. Simple, jargon-free interface suitable for non-risk-management staff

All criteria verified through human testing checkpoint.
</verification>

<success_criteria>
- Human verification confirms all mobile features work correctly
- No critical bugs blocking tester workflow
- PWA installs and works offline
- Photo upload functions on mobile
- Test submissions sync correctly
</success_criteria>

<output>
After completion, create `.planning/phases/36-mobile-control-tester/36-05-SUMMARY.md`
</output>
